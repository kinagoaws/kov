import{X as F,_ as j,ad as G,U as X,ae as Y,l as Z,m as i,Y as l,f as r,p as t,af as y,F as u,Q as P,n as f,P as n,R as c,ac as h,bg as L,$ as q,a0 as m,S as p,bh as V,Z as O,ai as J}from"./index.c5b868f5.js";import{Q as K}from"./QToolbar.9b15bf0e.js";import{Q as W}from"./QHeader.b374650f.js";import{Q as U}from"./QInnerLoading.ff23f6a9.js";import{Q}from"./QSpace.24950ca6.js";import{Q as v}from"./QItemLabel.4665782c.js";import{Q as z}from"./QLinearProgress.05dc3008.js";import{Q as B,a as k}from"./QStepper.2be652f3.js";import{Q as E}from"./QImg.79fcc1c6.js";import{Q as R}from"./QList.9b7158f1.js";import{Q as $}from"./QExpansionItem.041912ee.js";import{Q as ee}from"./QPage.528ab8a8.js";import{u as re}from"./CartData.5b90ca7b.js";import{s as b,a as H,d as I,f as w,b as x,c as A,q as oe,w as te,o as ae,l as se,g as de,e as ie}from"./FirebaseChat.017a0d5e.js";import"./QResizeObserver.3ed5059f.js";import"./QSlideTransition.1f937a0a.js";import"./use-render-cache.3aae9b27.js";import"./touch.9135741d.js";import"./selection.65959ca5.js";const ne={async createChatOrder(e,a,g,d){return await new Promise(async function(_,C){try{const s={lastUpdated:b(),dateCreated:b(),orderID:e,orderUuid:a,participants:[g,d],isTyping:{[`${g}`]:!1,[`${d}`]:!1}};await H(I(w,x.chats,a),s),_(a)}catch(s){C(s)}})},async createChat(e,a){return await new Promise(async function(d,o){try{const _=A(w,x.chats),C=oe(_,te("participants","array-contains",a),ae("lastUpdated","desc"),se(1));let s="";if((await de(C)).forEach(D=>{(D.data().participants||null).includes(e)===!0&&(s=D.id)}),!F.empty(s))d(s);else{const S=(await ie(A(w,x.chats),{lastUpdated:b()})).id,T=I(w,x.chats,S);let M={lastUpdated:b(),dateCreated:b(),participants:[a,e],isTyping:{[`${a}`]:!1,[`${e}`]:!1}};H(T,M).then(()=>{d(S)}).catch(N=>{o(N)})}}catch(_){o(_)}})}},le={name:"CheckoutSuccesful",components:{ComponentsRealtime:G(()=>J(()=>import("./ComponentsRealtime.a3fe8e7f.js"),["assets/ComponentsRealtime.a3fe8e7f.js","assets/index.c5b868f5.js","assets/index.7897e990.css"]))},data(){return{dialog:!0,step:1,order_uuid:"",order_status:"",order_progress:-1,order_status_details:"",instructions:[],redirect:"",loading_chat:!1,user_uuid:"",completed:!1}},setup(e){const a=re(),g=X();return{CartData:a,SettingStore:g}},mounted(){this.order_uuid=this.$route.query.order_uuid,this.redirect=this.$route.query.redirect,this.CartData.getOrder(this.order_uuid);let e=Y.getUser();this.user_uuid=e.client_uuid,this.$watch(()=>this.CartData.$state.order_data,(a,g)=>{this.order_progress=a.progress.order_progress,this.order_status=a.progress.order_status,this.order_status_details=a.progress.order_status_details,this.instructions=a.instructions,this.completed=a.progress.completed})},watch:{SettingStore:{immediate:!1,deep:!0,handler(e,a){Object.keys(e.realtime_data).length>0&&e.realtime_data.event=="event-tracking-order"&&this.afterReceive(e.realtime_data.data)}}},methods:{Close(){console.log("Close",this.redirect),this.redirect=="back"?this.$router.back():this.$router.replace("/home")},afterReceive(e){if(console.log("afterReceive",e),e.order_id!==this.CartData.order_data.order_info.order_id)return!1;e.order_progress===0?(this.order_progress=e.order_progress,this.order_status=e.order_status,this.order_status_details=e.order_status_details,this.completed=e.completed):e.order_progress===-1||(this.order_progress=e.order_progress,this.order_status=e.order_status,this.order_status_details=e.order_status_details,this.completed=e.completed)},itemCount(e){return e>1?e+" "+this.$t("items"):e+" "+this.$t("item")},async createChat(){this.loading_chat=!0,ne.createChatOrder(this.CartData.order_data.order_info.order_id,this.CartData.order_data.order_info.order_uuid,this.CartData.order_data.merchant_info.merchant_uuid,this.user_uuid).then(e=>{this.$router.push({path:"/account/chat/conversation",query:{doc_id:e}})}).catch(e=>{APIinterface.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_chat=!1})}}},ce={class:"full-width text-center relative-position"},ue={class:"text-weight-medium text-body1"},_e={class:"text-grey text-body2"},me={class:"column items-center justify-center q-gutter-y-sm"},pe={class:"col"},fe={class:"col"},he=["innerHTML"],ge=["innerHTML"];function ye(e,a,g,d,o,_){const C=Z("ComponentsRealtime");return i(),l(u,null,[r(W,{reveal:"","reveal-offset":50,class:y({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:t(()=>[r(K,null,{default:t(()=>[r(P,{round:"",dense:"",icon:"close",unelevated:"",color:e.$q.dark.mode?"grey":"mygrey","text-color":e.$q.dark.mode?"grey-9":"dark",replace:"true",onClick:_.Close},null,8,["color","text-color","onClick"])]),_:1})]),_:1},8,["class"]),r(ee,{class:"q-pl-md q-pr-md"},{default:t(()=>[d.CartData.order_loading?(i(),f(U,{key:0,showing:!0,color:e.$q.dark.mode?"grey300":"primary"},null,8,["color"])):(i(),l(u,{key:1},[n("div",{class:y(["radius20 flex flex-center bg-mygrey card-small-height",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode}])},[n("div",ce,[a[2]||(a[2]=n("svg",{class:"checkmark",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52"},[n("circle",{class:"checkmark__circle",cx:"26",cy:"26",r:"25",fill:"none"}),n("path",{class:"checkmark__check",fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})],-1)),d.CartData.hasOrderDetails?(i(),l(u,{key:0},[n("div",ue,c(e.$t("Order received order"))+" #"+c(d.CartData.order_data.order_info.order_id),1),n("div",_e,c(e.$t("Got your order"))+" "+c(d.CartData.order_data.order_info.customer_name)+"! ",1)],64)):h("",!0)])],2),r(Q,{class:"q-pa-sm"}),d.CartData.hasOrderDetails?(i(),f(V,{key:0,class:"no-shadow",bordered:""},{default:t(()=>[r(L,null,{default:t(()=>[r(q,{class:"q-pa-none q-mb-sm"},{default:t(()=>[r(m,null,{default:t(()=>[r(v,{class:y(["text-body1",{"text-green":o.completed}])},{default:t(()=>[p(c(o.order_status),1)]),_:1},8,["class"]),r(v,{caption:""},{default:t(()=>[p(c(o.order_status_details),1)]),_:1})]),_:1}),o.completed?h("",!0):(i(),f(m,{key:0,side:"",class:"text-body2 text-weight-bold"}))]),_:1}),d.CartData.order_data.order_info.order_type=="delivery"?(i(),l(u,{key:0},[o.order_progress>0?(i(),l(u,{key:0},[o.order_progress<=3?(i(),f(z,{key:0,indeterminate:"",color:"secondary"})):h("",!0),r(Q,{class:"q-pa-xs"})],64)):h("",!0)],64)):(i(),l(u,{key:1},[o.order_progress>0?(i(),l(u,{key:0},[o.order_progress<=2?(i(),f(z,{key:0,indeterminate:"",color:"secondary"})):h("",!0),r(Q,{class:"q-pa-xs"})],64)):h("",!0)],64)),n("div",{class:y(["q-pa-sm radius10",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode}])},[d.CartData.order_data.order_info.order_type=="delivery"?(i(),f(B,{key:0,modelValue:o.order_progress,"onUpdate:modelValue":a[0]||(a[0]=s=>o.order_progress=s),ref:"stepper",contracted:"",animated:"",flat:"",class:"bg-transparent","done-color":"primary","active-color":"primary","inactive-color":e.$q.dark.mode?"grey300":"white"},{default:t(()=>[r(k,{name:1,icon:"check","active-icon":"done_all","done-icon":"done_all","done-color":o.order_progress>1?"primary":"red",done:o.order_progress>1||o.order_progress<=0},null,8,["done-color","done"]),r(k,{name:2,icon:"restaurant","active-icon":"restaurant","done-icon":"restaurant","done-color":o.order_progress>2?"primary":"red",done:o.order_progress>2||o.order_progress<=0},null,8,["done-color","done"]),r(k,{name:3,icon:"directions_run","active-icon":"directions_run","done-icon":"directions_run","done-color":o.order_progress>3?"primary":"red",done:o.order_progress>3||o.order_progress<=0},null,8,["done-color","done"]),r(k,{name:4,icon:"flag","active-icon":"flag","done-icon":"flag","done-color":o.order_progress>4?"primary":"red",done:o.order_progress>4||o.order_progress<=0},null,8,["done-color","done"])]),_:1},8,["modelValue","inactive-color"])):(i(),f(B,{key:1,modelValue:o.order_progress,"onUpdate:modelValue":a[1]||(a[1]=s=>o.order_progress=s),ref:"stepper",contracted:"",animated:"",flat:"",class:"bg-transparent","done-color":"primary","active-color":"primary","inactive-color":"white"},{default:t(()=>[r(k,{name:1,icon:"check","active-icon":"done_all","done-icon":"done_all","done-color":o.order_progress>1?"primary":"red",done:o.order_progress>1||o.order_progress<=0},null,8,["done-color","done"]),r(k,{name:2,icon:"restaurant","active-icon":"restaurant","done-icon":"restaurant","done-color":o.order_progress>2?"primary":"red",done:o.order_progress>2||o.order_progress<=0},null,8,["done-color","done"]),r(k,{name:3,icon:"flag","active-icon":"flag","done-icon":"flag","done-color":o.order_progress>3?"primary":"red",done:o.order_progress>3||o.order_progress<=0},null,8,["done-color","done"])]),_:1},8,["modelValue"]))],2),r(Q,{class:"q-pa-xs"}),r(q,null,{default:t(()=>[r(m,{avatar:""},{default:t(()=>[r(E,{src:d.CartData.order_data.merchant_info.url_logo,style:{width:"50px",height:"50px"},fit:"contain","spinner-color":"primary","spinner-size":"xs",class:"rounded-borders"},null,8,["src"])]),_:1}),r(m,null,{default:t(()=>[r(v,{class:"text-weight-bold"},{default:t(()=>[p(c(d.CartData.order_data.merchant_info.restaurant_name),1)]),_:1}),r(v,{caption:""},{default:t(()=>[p(c(d.CartData.order_data.merchant_info.address),1)]),_:1})]),_:1}),r(m,{side:""},{default:t(()=>[n("div",me,[n("div",pe,[r(P,{round:"",color:"primary",icon:"las la-phone",unelevated:"",href:"tel:"+d.CartData.order_data.merchant_info.contact_phone,size:"sm"},null,8,["href"])]),n("div",fe,[r(P,{round:"",color:"blue",icon:"chat",unelevated:"",size:"sm",onClick:_.createChat,loading:o.loading_chat},null,8,["onClick","loading"])])])]),_:1})]),_:1}),r(R,{dense:""},{default:t(()=>[r($,{"expand-separator":"",label:_.itemCount(parseInt(d.CartData.order_data.items_count)),caption:e.$t("Total price")+" "+d.CartData.order_data.order_info.pretty_total},{default:t(()=>[r(V,{class:"text-weight-light"},{default:t(()=>[r(L,{class:"q-pa-none"},{default:t(()=>[r(R,null,{default:t(()=>[(i(!0),l(u,null,O(d.CartData.order_data.items,s=>(i(),l("div",{key:s,class:y(["radius10 q-mb-sm",{"bg-grey600":e.$q.dark.mode,"bg-secondary ":!e.$q.dark.mode}])},[r(q,null,{default:t(()=>[r(m,{avatar:""},{default:t(()=>[r(E,{src:s.url_image,style:{width:"50px",height:"50px"},fit:"cover","spinner-color":"primary","spinner-size":"xs",class:"rounded-borders"},null,8,["src"])]),_:2},1024),r(m,null,{default:t(()=>[r(v,null,{default:t(()=>[p(c(s.qty)+" x ",1),n("span",{innerHTML:s.item_name},null,8,he),s.size_name?(i(),l(u,{key:0},[a[3]||(a[3]=p(" (")),n("span",{innerHTML:s.size_name},null,8,ge),a[4]||(a[4]=p(") "))],64)):h("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)],2))),128))]),_:1}),r(R,{bordered:"",dense:"",class:"radius10 q-pt-xs q-pb-xs"},{default:t(()=>[(i(!0),l(u,null,O(d.CartData.order_data.order_info.summary,s=>(i(),f(q,{key:s,class:"item-normal-height"},{default:t(()=>[r(m,{class:y(["text-caption",s.type=="total"?"text-weight-bold":""])},{default:t(()=>[p(c(s.name),1)]),_:2},1032,["class"]),r(m,{side:"",class:y(["text-caption",s.type=="total"?"text-weight-bold":""])},{default:t(()=>[p(c(s.value),1)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["label","caption"])]),_:1})]),_:1})]),_:1})):h("",!0)],64)),r(C)]),_:1})],64)}var Ie=j(le,[["render",ye]]);export{Ie as default};
