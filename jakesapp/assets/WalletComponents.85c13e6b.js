import{_ as y,O as w,X as r,m as i,Y as p,f as e,p as l,$ as C,a0 as d,a1 as D,n as _,af as g,F as b,S as h,R as c,P as k,ac as W,bc as Q}from"./index.c5b868f5.js";import{Q as S}from"./QSkeleton.11b8074a.js";import{Q as u}from"./QItemLabel.4665782c.js";import{Q as q}from"./QList.9b7158f1.js";import{Q as v}from"./QInnerLoading.ff23f6a9.js";import{u as P}from"./CartData.5b90ca7b.js";const V={name:"WalletComponents",props:["cart_updated"],data(){return{use_wallet:!1,data:[],loading:!1,message:"",loading_apply:!1}},setup(){const a=w(),t=P();return{DataStorePersisted:a,CartData:t}},watch:{cart_updated(a,t){a==!1&&(console.log("getCartWallet",1),this.getCartWallet())}},computed:{canUseWallet(){return Object.keys(this.data).length>0&&this.data.balance_raw>0},getData(){return this.data}},mounted(){Object.keys(this.CartData.cart_total).length>0?(console.log("getCartWallet",2),this.getCartWallet()):this.$watch(()=>this.CartData.$state.cart_total,(a,t)=>{console.log("getCartWallet",3),this.getCartWallet()})},methods:{getCartWallet(){this.loading=!0;let a=r.empty(this.CartData.cart_total)?null:this.CartData.cart_total.raw;r.fetchDataByTokenPost("getCartWallet","cart_uuid="+r.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()+"&amount_to_pay="+a).then(t=>{this.data=t.details,this.use_wallet=t.details.use_wallet,this.use_wallet&&(this.$emit("afterApplywallet",t.details.apply_wallet_data),t.details.apply_wallet_data.amount_due_raw>0&&(this.message=t.details.apply_wallet_data.message))}).catch(t=>{this.data=[],this.use_wallet=!1}).then(t=>{this.loading=!1})},applyDigitalWallet(a){this.loading_apply=!0;let t=a?1:0,m=r.empty(this.CartData.cart_total)?null:this.CartData.cart_total.raw;r.fetchDataByTokenPost("applyDigitalWallet","cart_uuid="+r.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()+"&use_wallet="+t+"&amount_to_pay="+m).then(o=>{t?this.message=o.msg:this.message="",this.$emit("afterApplywallet",o.details)}).catch(o=>{this.use_wallet=!1,this.message="",r.notify("dark",o,"error",this.$q)}).then(o=>{this.loading_apply=!1})}}},B={class:"relative-position"};function U(a,t,m,o,s,n){return i(),p("div",B,[e(q,{bordered:"",dense:"",class:"rounded-borders q-pt-sm q-pb-sm q-mb-sm"},{default:l(()=>[e(C,{clickable:"",tag:"label"},{default:l(()=>[e(d,{avatar:"",class:"item-column-less"},{default:l(()=>[e(D,{color:"primary","text-color":"white",icon:"account_balance_wallet",size:"md"})]),_:1}),e(d,null,{default:l(()=>[e(u,null,{default:l(()=>[s.loading?(i(),_(S,{key:0,recttype:"type",class:g({"bg-grey600":a.$q.dark.mode,"bg-mygrey":!a.$q.dark.mode})},null,8,["class"])):(i(),p(b,{key:1},[h(c(n.getData.balance),1)],64))]),_:1}),e(u,{caption:""},{default:l(()=>[h(c(a.$t("Use Wallet Balance")),1)]),_:1}),s.message?(i(),_(u,{key:0,caption:""},{default:l(()=>[k("div",{class:g(["q-pa-sm radius10 text-weight-thin",{"bg-grey600 text-white":a.$q.dark.mode," bg-grey-2 text-dark":!a.$q.dark.mode}])},c(s.message),3)]),_:1})):W("",!0)]),_:1}),e(d,{side:""},{default:l(()=>[e(Q,{modelValue:s.use_wallet,"onUpdate:modelValue":[t[0]||(t[0]=f=>s.use_wallet=f),n.applyDigitalWallet],val:"1",color:"yellow-9",disable:!n.canUseWallet||s.loading_apply},null,8,["modelValue","disable","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),e(v,{showing:s.loading_apply,color:"yellow-9"},null,8,["showing"])])}var O=y(V,[["render",U]]);export{O as default};
