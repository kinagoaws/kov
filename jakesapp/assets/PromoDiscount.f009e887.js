import{_ as Q,O as w,X as l,m as i,Y as c,P as f,f as o,p as t,a0 as u,a1 as q,S as p,R as d,n as _,af as g,F as h,ac as v,Q as y,as as k,ah as B,$ as P,bh as V,bg as S,b8 as C,ag as A,Z as I,bT as T,aX as U}from"./index.c5b868f5.js";import{Q as b}from"./QItemLabel.4665782c.js";import{Q as $}from"./QSkeleton.11b8074a.js";import{Q as z}from"./QSpace.24950ca6.js";import{Q as N}from"./QList.9b7158f1.js";import{Q as O}from"./QForm.997d74f6.js";import{C as D}from"./ClosePopup.32eeb9ff.js";import{u as j}from"./CartData.5b90ca7b.js";const F={name:"PromoDiscount",data(){return{modal:!1,data:[],promo_selected:[],loading:!1,total_promo:0,promo_code:"",refresh:!1,loading_remove:!1,loading_apply:!1}},setup(){const e=j(),a=w();return{CartData:e,DataStorePersisted:a}},computed:{hasPromo(){return Object.keys(this.data).length>0},hasPromoselected(){return Object.keys(this.promo_selected).length>0}},mounted(){Object.keys(this.CartData.cart_items).length>0?this.loadPromo():this.$watch(()=>this.SettingStore.$state.cart_items,(e,a)=>{this.loadPromo()})},methods:{beforeShow(){this.promo_code=""},loadPromo(){this.loading=!0,l.fetchDataPost("loadPromo","cart_uuid="+l.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()).then(e=>{this.total_promo=e.details.count,this.data=e.details.data,this.promo_selected=e.details.promo_selected}).catch(e=>{}).then(e=>{this.loading=!1})},showPromo(){this.modal=!0},Submit(){this.loading_apply=!0;const e={cart_uuid:l.getStorage("cart_uuid"),promo_code:this.promo_code,currency_code:this.DataStorePersisted.getUseCurrency(),transaction_type:this.DataStorePersisted.transaction_type};l.fetchDataByToken("applyPromoCode",e).then(a=>{this.modal=!1,this.loadPromo()}).catch(a=>{l.notify("dark",a,"error_outline",this.$q)}).then(a=>{this.loading_apply=!1})},usePromo(e){const a={cart_uuid:l.getStorage("cart_uuid"),promo_id:e.promo_id,promo_type:e.promo_type,currency_code:this.DataStorePersisted.getUseCurrency(),transaction_type:this.DataStorePersisted.transaction_type};this.refresh=!0,l.fetchDataByToken("applyPromo",a).then(n=>{this.modal=!1,this.loadPromo()}).catch(n=>{l.notify("dark",n,"error_outline",this.$q)}).then(n=>{this.refresh=!1,this.$emit("afterApplypromo")})},removePromo(e){this.loading_remove=!0;const a={cart_uuid:l.getStorage("cart_uuid"),promo_id:e.promo_id,promo_type:e.promo_type,transaction_type:this.DataStorePersisted.transaction_type};l.fetchDataByToken("removePromo",a).then(n=>{this.modal=!1,this.promo_selected=[]}).catch(n=>{l.notify("dark",n,"error_outline",this.$q)}).then(n=>{this.loading_remove=!1,this.$emit("afterRemovepromo")})}}},L={class:"text-caption text-green"},E={class:"text-h6 text-weight-bold"},R={class:"q-pa-md q-pt-none"};function X(e,a,n,x,r,m){return i(),c(h,null,[f("div",{class:g(["radius10 q-mb-sm",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode}])},[o(P,{clickable:"",onClick:k(m.showPromo,["stop"])},{default:t(()=>[o(u,{avatar:"",top:"",class:"item-column-less"},{default:t(()=>[o(q,{color:"primary","text-color":"white",icon:"local_offer",size:"md"})]),_:1}),o(u,null,{default:t(()=>[o(b,{caption:""},{default:t(()=>[p(d(e.$t("Add Promo")),1)]),_:1}),o(b,null,{default:t(()=>[r.loading?(i(),_($,{key:0,recttype:"type",class:g({"bg-grey600":e.$q.dark.mode,"bg-mygrey":!e.$q.dark.mode})},null,8,["class"])):(i(),c(h,{key:1},[m.hasPromoselected?(i(),c(h,{key:0},[p(d(e.$t("Promotion applied"))+" ",1),f("div",L,d(r.promo_selected.savings),1)],64)):(i(),c(h,{key:1},[r.total_promo>0?(i(),c(h,{key:0},[p(d(r.total_promo)+" "+d(e.$t("promotional available")),1)],64)):v("",!0)],64))],64))]),_:1})]),_:1}),o(u,{side:""},{default:t(()=>[m.hasPromoselected?(i(),_(y,{key:0,onClick:a[0]||(a[0]=k(s=>m.removePromo(r.promo_selected),["stop"])),icon:"clear",round:"",size:"sm",flat:"",unelevated:"","no-caps":"",color:"negative",loading:r.loading_remove},null,8,["loading"])):(i(),_(B,{key:1,name:"chevron_right",color:"grey"}))]),_:1})]),_:1},8,["onClick"])],2),o(U,{modelValue:r.modal,"onUpdate:modelValue":a[2]||(a[2]=s=>r.modal=s),persistent:"",position:"bottom","transition-show":"fade","transition-hide":"fadeout",onBeforeShow:m.beforeShow},{default:t(()=>[o(V,{class:g({"bg-grey600":e.$q.dark.mode,"bg-mygrey":!e.$q.dark.mode})},{default:t(()=>[o(O,{onSubmit:m.Submit},{default:t(()=>[o(S,{class:"row items-center q-pb-none"},{default:t(()=>[f("div",E,d(e.$t("Promo")),1),o(z),C(o(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[D]])]),_:1}),o(S,{style:{"max-height":"50vh","min-height":"30vh"},class:"scroll q-pa-none"},{default:t(()=>[f("div",R,[f("div",{class:g(["radius10 q-mb-xs",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode,disabled:r.refresh}])},[o(P,null,{default:t(()=>[o(u,null,{default:t(()=>[o(A,{modelValue:r.promo_code,"onUpdate:modelValue":a[1]||(a[1]=s=>r.promo_code=s),label:e.$t("Enter Promo Code"),"stack-label":"",rules:[s=>s&&s.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"])]),_:1}),o(u,{side:""},{default:t(()=>[o(y,{type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:e.$t("Apply"),size:"15px",loading:r.loading_apply},null,8,["label","loading"])]),_:1})]),_:1})],2)]),m.hasPromo?(i(),_(N,{key:0,separator:"",bordered:"",class:g({disabled:r.refresh})},{default:t(()=>[(i(!0),c(h,null,I(r.data,s=>(i(),_(P,{key:s,clickable:"",tag:"label",onClick:k(M=>m.usePromo(s),["stop"])},{default:t(()=>[o(u,null,{default:t(()=>[o(b,null,{default:t(()=>[p(d(s.title),1)]),_:2},1024),o(b,{caption:""},{default:t(()=>[p(d(s.sub_title),1)]),_:2},1024),o(b,{caption:""},{default:t(()=>[p(d(s.valid_to),1)]),_:2},1024)]),_:2},1024),o(u,{side:""},{default:t(()=>[o(y,{flat:"",label:"Use Now",unelevated:"",color:"primary","no-caps":"",disable:r.refresh},null,8,["disable"])]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1},8,["class"])):v("",!0)]),_:1}),o(T,null,{default:t(()=>[C(o(y,{unelevated:"",rounded:"",color:"red-2","text-color":"red-9","no-caps":"",class:"full-width",label:e.$t("Close"),size:"17px",loading:r.refresh},null,8,["label","loading"]),[[D]])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class"])]),_:1},8,["modelValue","onBeforeShow"])],64)}var oe=Q(F,[["render",X]]);export{oe as default};
