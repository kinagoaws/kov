import{Q as v}from"./QSpace.24950ca6.js";import{_ as k,bD as b,ae as y,X as n,m as f,n as w,p as o,f as l,bh as V,bg as g,P as i,R as u,b8 as F,Q as c,ag as p,ah as Q,Y as _,F as x,Z as R,bc as q,ac as U,bd as A,af as C,S as j,aX as S}from"./index.c5b868f5.js";import{Q as $}from"./QRating.300c19c5.js";import{Q as z}from"./QUploaderAddTrigger.57c0cfeb.js";import{Q as D}from"./QUploader.c56a2d76.js";import{Q as T}from"./QFooter.51024c6d.js";import{Q as B}from"./QForm.997d74f6.js";import{C as E}from"./ClosePopup.32eeb9ff.js";import"./format.8ac60962.js";import"./QCircularProgress.1d7da185.js";import"./QResizeObserver.3ed5059f.js";const O={name:"AddReview",data(){return{modal:!1,loading:!1,upload_api:b.api_base_url+"/partnerapi/uploadReview",rating_value:0,as_anonymous:!1,review_content:"",tags_like:"",tags_not_like:"",upload_images:"",order_uuid:"",files:{},file_data:[],upload_loading:!1}},setup(){return{}},methods:{getToken(){return y.getToken()},onSubmit(){Object.keys(this.files).length>0?this.$refs.uploader.upload():this.addReview()},addReview(){const e={order_uuid:this.order_uuid,review_content:this.review_content,rating_value:this.rating_value,as_anonymous:this.as_anonymous,tags_like:[this.tags_like],tags_not_like:[this.tags_not_like],upload_images:{url_image:this.file_data.url_image,filename:this.file_data.filename,id:this.file_data.id}};this.loading=!0,n.fetchDataByTokenPost("addReview",e).then(t=>{n.notify("dark",t.msg,"check_circle",this.$q),this.modal=!1,this.$emit("afterAddreview")}).catch(t=>{n.notify("dark",t,"error_outline",this.$q)}).then(t=>{this.loading=!1})},pickFiles(){this.$refs.uploader.pickFiles()},onRejectedFiles(e){let t="";Object.entries(e).forEach(([r,m])=>{t+=m.failedPropValidation}),n.notify("dark",this.$t("Error")+" "+t,"error",this.$q)},afterAddedFiles(e){console.log("afterAddedFiles",e),Object.entries(e).forEach(([t,r])=>{this.files[r.name]={name:r.name}})},afterRemoveFiles(e){Object.entries(e).forEach(([t,r])=>{delete this.files[r.name]})},onUploadingFiles(e){this.upload_loading=!0},afterUploaded(e){if(e.xhr.status==200){let t=JSON.parse(e.xhr.response);console.log("result",t);let r=t.code||!1,m=t.details||[],a=t.msg||"";r==1?(this.file_data=m,this.addReview()):(n.notify("dark",a,"error",this.$q),this.$refs.uploader.reset())}else n.notify("dark",this.$t("IError uploading files"),"error",this.$q),this.$refs.uploader.reset()},afterFinishUpload(){this.upload_loading=!1}}},P={class:"text-body1 text-weight-bold"},N={class:"q-mb-sm"},I={class:"text-subtitle1"},W={class:"text-subtitle1"},X={class:"text-subtitle1"},Y={class:"text-subtitle1"},J={class:"flex justify-start q-col-gutter-x-md"},L=["src"],Z={class:"absolute-right",style:{"margin-right":"-10px","margin-top":"-5px"}},G={class:"q-pb-md"},H={key:0,class:"q-pa-xl"};function K(e,t,r,m,a,d){return f(),w(S,{modelValue:a.modal,"onUpdate:modelValue":t[5]||(t[5]=s=>a.modal=s),persistent:"","transition-show":"fade","transition-hide":"fadeout",maximized:!0},{default:o(()=>[l(V,{class:"scroll"},{default:o(()=>[l(B,{onSubmit:d.onSubmit},{default:o(()=>[l(g,{class:"row items-center q-pb-none"},{default:o(()=>[i("div",P,u(e.$t("Write A Review")),1),l(v),F(l(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])]),_:1}),l(g,null,{default:o(()=>[i("div",N,[l($,{modelValue:a.rating_value,"onUpdate:modelValue":t[0]||(t[0]=s=>a.rating_value=s),size:"2em",max:5,color:"grey-5","color-selected":"yellow-2",class:"q-mb-xs"},null,8,["modelValue"])]),i("div",I,u(e.$t("What did you like"))+"?",1),l(p,{modelValue:a.tags_like,"onUpdate:modelValue":t[1]||(t[1]=s=>a.tags_like=s),class:"q-mb-md full-width",color:"primary",label:e.$t("Describe in few words"),dense:""},null,8,["modelValue","label"]),i("div",W,u(e.$t("What did you not like"))+"?",1),l(p,{modelValue:a.tags_not_like,"onUpdate:modelValue":t[2]||(t[2]=s=>a.tags_not_like=s),class:"q-mb-md full-width",color:"warning",label:e.$t("Describe in few words"),dense:""},null,8,["modelValue","label"]),i("div",X,u(e.$t("Write your review")),1),l(p,{modelValue:a.review_content,"onUpdate:modelValue":t[3]||(t[3]=s=>a.review_content=s),autogrow:"",class:"full-width",color:"primary",label:e.$t("Your review helps us to make better choices"),rules:[s=>s&&s.length>0||"This field is required"]},null,8,["modelValue","label","rules"]),i("div",Y,u(e.$t("Add Photo")),1),l(c,{unelevated:"",round:"",color:e.$q.dark.mode?"grey600":"mygrey","text-color":e.$q.dark.mode?"grey300":"grey",onClick:d.pickFiles,dense:""},{default:o(()=>[l(Q,{name:"attach_file",class:"rotate-45"})]),_:1},8,["color","text-color","onClick"]),l(D,{url:a.upload_api,"max-files":"1",ref:"uploader",flat:"",accept:".jpg, image/*","max-total-size":"10485760","field-name":"file",onAdded:d.afterAddedFiles,onRemoved:d.afterRemoveFiles,onRejected:d.onRejectedFiles,onUploading:d.onUploadingFiles,onUploaded:d.afterUploaded,onFinish:d.afterFinishUpload,class:"full-width",headers:[{name:"Authorization",value:`token ${this.getToken()}`}]},{header:o(()=>[l(z)]),list:o(s=>[i("div",J,[(f(!0),_(x,null,R(s.files,h=>(f(),_("div",{key:h.__key,class:"relative-position"},[i("img",{src:h.__img.src,style:{"max-width":"60px",height:"60px"},class:"radius10"},null,8,L),i("div",Z,[l(c,{unelevated:"",round:"",color:"blue",icon:"close",size:"xs",onClick:M=>s.removeFile(h)},null,8,["onClick"])])]))),128))])]),_:1},8,["url","onAdded","onRemoved","onRejected","onUploading","onUploaded","onFinish","headers"]),i("div",G,[l(q,{modelValue:a.as_anonymous,"onUpdate:modelValue":t[4]||(t[4]=s=>a.as_anonymous=s),size:"sm",color:"primary",label:e.$t("post review as anonymous")},null,8,["modelValue","label"])]),Object.keys(this.files).length>0?(f(),_("div",H)):U("",!0)]),_:1}),l(A),l(T,{class:C(["border-top q-pa-md",{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode}])},{default:o(()=>[l(c,{type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",loading:a.loading,size:"lg"},{default:o(()=>[j(u(e.$t("Submit Review")),1)]),_:1},8,["loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])}var me=k(O,[["render",K]]);export{me as default};
