import{W as B,bo as w,ao as D,ai as U,_ as M,ad as q,O as z,bp as W,U as H,X as m,ae as C,l as T,m as p,Y as L,f as n,p as c,af as A,F,Q as _,S as P,R as k,n as b,P as R,a1 as X,ac as x,ag as g}from"./index.c5b868f5.js";import{Q as Y}from"./QToolbarTitle.4da9f270.js";import{Q as j}from"./QToolbar.9b15bf0e.js";import{Q as G}from"./QHeader.b374650f.js";import{Q as V}from"./QInnerLoading.ff23f6a9.js";import{Q}from"./QImg.79fcc1c6.js";import{Q as J}from"./QSpace.24950ca6.js";import{Q as K}from"./QFooter.51024c6d.js";import{Q as Z}from"./QForm.997d74f6.js";import{Q as ee}from"./QPage.528ab8a8.js";var u;(function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"})(u||(u={}));var f;(function(e){e.Rear="REAR",e.Front="FRONT"})(f||(f={}));var S;(function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"})(S||(S={}));class O extends B{async getPhoto(t){return new Promise(async(r,i)=>{if(t.webUseInput||t.source===u.Photos)this.fileInputExperience(t,r,i);else if(t.source===u.Prompt){let a=document.querySelector("pwa-action-sheet");a||(a=document.createElement("pwa-action-sheet"),document.body.appendChild(a)),a.header=t.promptLabelHeader||"Photo",a.cancelable=!1,a.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],a.addEventListener("onSelection",async o=>{o.detail===0?this.fileInputExperience(t,r,i):this.cameraExperience(t,r,i)})}else this.cameraExperience(t,r,i)})}async pickImages(t){return new Promise(async(r,i)=>{this.multipleFileInputExperience(r,i)})}async cameraExperience(t,r,i){if(customElements.get("pwa-camera-modal")){const a=document.createElement("pwa-camera-modal");a.facingMode=t.direction===f.Front?"user":"environment",document.body.appendChild(a);try{await a.componentOnReady(),a.addEventListener("onPhoto",async o=>{const l=o.detail;l===null?i(new w("User cancelled photos app")):l instanceof Error?i(l):r(await this._getCameraPhoto(l,t)),a.dismiss(),document.body.removeChild(a)}),a.present()}catch{this.fileInputExperience(t,r,i)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,r,i)}fileInputExperience(t,r,i){let a=document.querySelector("#_capacitor-camera-input");const o=()=>{var l;(l=a.parentNode)===null||l===void 0||l.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input",a.type="file",a.hidden=!0,document.body.appendChild(a),a.addEventListener("change",l=>{const d=a.files[0];let s="jpeg";if(d.type==="image/png"?s="png":d.type==="image/gif"&&(s="gif"),t.resultType==="dataUrl"||t.resultType==="base64"){const h=new FileReader;h.addEventListener("load",()=>{if(t.resultType==="dataUrl")r({dataUrl:h.result,format:s});else if(t.resultType==="base64"){const N=h.result.split(",")[1];r({base64String:N,format:s})}o()}),h.readAsDataURL(d)}else r({webPath:URL.createObjectURL(d),format:s}),o()}),a.addEventListener("cancel",l=>{i(new w("User cancelled photos app")),o()})),a.accept="image/*",a.capture=!0,t.source===u.Photos||t.source===u.Prompt?a.removeAttribute("capture"):t.direction===f.Front?a.capture="user":t.direction===f.Rear&&(a.capture="environment"),a.click()}multipleFileInputExperience(t,r){let i=document.querySelector("#_capacitor-camera-input-multiple");const a=()=>{var o;(o=i.parentNode)===null||o===void 0||o.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input-multiple",i.type="file",i.hidden=!0,i.multiple=!0,document.body.appendChild(i),i.addEventListener("change",o=>{const l=[];for(let d=0;d<i.files.length;d++){const s=i.files[d];let h="jpeg";s.type==="image/png"?h="png":s.type==="image/gif"&&(h="gif"),l.push({webPath:URL.createObjectURL(s),format:h})}t({photos:l}),a()}),i.addEventListener("cancel",o=>{r(new w("User cancelled photos app")),a()})),i.accept="image/*",i.click()}_getCameraPhoto(t,r){return new Promise((i,a)=>{const o=new FileReader,l=t.type.split("/")[1];r.resultType==="uri"?i({webPath:URL.createObjectURL(t),format:l,saved:!1}):(o.readAsDataURL(t),o.onloadend=()=>{const d=o.result;r.resultType==="dataUrl"?i({dataUrl:d,format:l,saved:!1}):i({base64String:d.split(",")[1],format:l,saved:!1})},o.onerror=d=>{a(d)})})}async checkPermissions(){if(typeof navigator=="undefined"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}new O;const v=D("Camera",{web:()=>new O});var I;(function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE"})(I||(I={}));var $;(function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"})($||($={}));const y=D("Filesystem",{web:()=>U(()=>import("./web.d0e7e5c5.js"),["assets/web.d0e7e5c5.js","assets/index.c5b868f5.js","assets/index.7897e990.css","assets/QToolbarTitle.4da9f270.js","assets/QToolbar.9b15bf0e.js","assets/QHeader.b374650f.js","assets/QResizeObserver.3ed5059f.js","assets/QInnerLoading.ff23f6a9.js","assets/QImg.79fcc1c6.js","assets/QSpace.24950ca6.js","assets/QFooter.51024c6d.js","assets/QForm.997d74f6.js","assets/QPage.528ab8a8.js"]).then(e=>new e.FilesystemWeb)}),E={async isCameraEnabled(){return await new Promise(function(t,r){v.checkPermissions().then(i=>{switch(i.camera){case"prompt":case"prompt-with-rationale":case"denied":v.requestPermissions().then(a=>{switch(a.camera){case"granted":t("granted");break;default:r("denied");break}}).catch(a=>{r(a)});break;case"granted":t("granted");break}}).catch(i=>{r(i)})})},async isFileAccessEnabled(){return await new Promise(function(t,r){y.checkPermissions().then(i=>{switch(i.publicStorage){case"prompt":case"prompt-with-rationale":case"denied":y.requestPermissions().then(a=>{switch(a.publicStorage){case"granted":t("granted");break;default:r("denied");break}}).catch(a=>{r(a)});break;case"granted":t("granted");break;default:r("denied");break}}).catch(i=>{r(i)})})},async getPhoto(e){let t=u.Prompt;e==2?t=u.Camera:e==3&&(t=u.Photos);const r=await v.getPhoto({quality:90,allowEditing:!1,resultType:S.Uri,width:500,source:t});if(r){const i=await y.readFile({path:r.path});if(i)return{format:r.format,path:r.webPath,data:i.data}}return!1},async ReadFile(e){const t=await y.readFile({path:e});return t||!1}},te={name:"UpdateProfile",components:{TwoStepsVerification:q(()=>U(()=>import("./TwoStepsVerification.3557b755.js"),["assets/TwoStepsVerification.3557b755.js","assets/index.c5b868f5.js","assets/index.7897e990.css","assets/QToolbarTitle.4da9f270.js","assets/QToolbar.9b15bf0e.js","assets/QSpace.24950ca6.js","assets/QForm.997d74f6.js","assets/ClosePopup.32eeb9ff.js"])),UploaderFile:q(()=>U(()=>import("./UploaderFile.e1525c7c.js"),["assets/UploaderFile.e1525c7c.js","assets/QUploader.c56a2d76.js","assets/index.c5b868f5.js","assets/index.7897e990.css","assets/QCircularProgress.1d7da185.js","assets/format.8ac60962.js"]))},data(){return{loading:!0,loading_submit:!1,first_name:"",last_name:"",email_address:"",mobile_number:"",mobile_prefix:"",original_email_address:"",original_mobile_number:"",otp:"",otp_message:"",photo_data:[],upload_enabled:!1,featured_filename:"",featured_url:"",upload_path:"",has_photo:!1,knob:71,page_ready:!1}},setup(e){const t=z(),r=W(),i=H();return{DataStorePersisted:t,UserStore:r,SettingStore:i}},mounted(){Object.keys(this.SettingStore.settings_data).length>0?(this.mobile_prefix=this.SettingStore.settings_data.phone_data.phonecode,this.getProfiledata()):this.$watch(()=>this.SettingStore.$state.settings_data,(e,t)=>{this.mobile_prefix=e.phone_data.phonecode,this.getProfiledata()})},computed:{hasData(){return!m.empty(this.featured_url)},hasPhoto(){return Object.keys(this.photo_data).length>0}},methods:{getProfiledata(){this.getProfile()},getProfile(){this.loading=!0,m.fetchDataByToken("getProfile","").then(e=>{this.UserStore.user_data=e.details,this.first_name=e.details.first_name,this.last_name=e.details.last_name,this.email_address=e.details.email_address,this.mobile_number=e.details.mobile_number,this.mobile_prefix=e.details.mobile_prefix,this.featured_url=e.details.avatar,this.original_email_address=this.email_address,this.original_mobile_number=this.mobile_number}).catch(e=>{m.notify("dark",e,"error_outline",this.$q),this.UserStore.user_data=[]}).then(e=>{this.loading=!1})},checkForm(){console.log("this.email_address",this.email_address),console.log("this.mobile_number",this.mobile_number),console.log("this.original_email_address",this.original_email_address),console.log("this.original_mobile_number",this.original_mobile_number);let e=!1;this.email_address!==this.original_email_address&&(e=!0),this.mobile_number!==this.original_mobile_number&&(e=!0),console.log("_change",e),e?(this.loading_submit=!0,m.fetchDataByToken("RequestEmailCode").then(t=>{this.otp_message=t.msg,this.$refs.verification.showModal(!0)}).catch(t=>{m.notify("dark",t,"error_outline",this.$q)}).then(t=>{this.loading_submit=!1})):this.onSubmit()},afterVerify(e){this.otp=e,this.onSubmit()},onSubmit(){this.loading_submit=!0;const e={code:this.otp,first_name:this.first_name,last_name:this.last_name,email_address:this.email_address,mobile_number:this.mobile_number,mobile_prefix:this.mobile_prefix,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:""};m.fetchDataByToken("saveProfile",e).then(t=>{this.$refs.verification.showModal(!1),C.setUser(t.details),m.notify(this.$q.dark.mode?"grey600":"dark",t.msg,"check_circle",this.$q);let r=C.getUser();this.UserStore.user_data={first_name:this.first_name,last_name:this.last_name,email_address:this.email_address,mobile_number:this.mobile_number,mobile_prefix:this.mobile_prefix,avatar:r?r.avatar:""},this.original_email_address=this.email_address,this.original_mobile_number=this.mobile_number}).catch(t=>{m.notify("dark",t,"error_outline",this.$q)}).then(t=>{this.loading_submit=!1})},takePhoto(){this.$q.capacitor?E.isCameraEnabled().then(e=>{E.isFileAccessEnabled().then(t=>{E.getPhoto(1).then(r=>{this.photo_data=r}).catch(r=>{this.photo_data=[]})}).catch(t=>{m.notify("dark",t,"error",this.$q)})}).catch(e=>{m.notify("dark",e,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterUploadfile(e){this.featured_filename=e.filename,this.featured_url=e.url_image,this.upload_path=e.upload_path},hadData(){return Object.keys(this.photo_data).length>0}}},ae={class:"row items-center justify-center q-mb-md"},ie={class:"col-3 relative-position text-center"};function re(e,t,r,i,a,o){const l=T("UploaderFile"),d=T("TwoStepsVerification");return p(),L(F,null,[n(G,{class:A(["bg-whitex",{"bg-mydark ":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode}]),reveal:""},{default:c(()=>[n(j,null,{default:c(()=>[n(_,{onClick:t[0]||(t[0]=s=>e.$router.back()),round:"",dense:"",icon:"arrow_back",unelevated:"",color:e.$q.dark.mode?"grey":"mygrey","text-color":e.$q.dark.mode?"grey-9":"dark"},null,8,["color","text-color"]),n(Y,{class:"text-weight-bold text-darkx"},{default:c(()=>[P(k(e.$t("Edit Info")),1)]),_:1})]),_:1})]),_:1},8,["class"]),n(ee,{class:"q-pa-md"},{default:c(()=>[a.page_ready?(p(),b(V,{key:0,showing:!0,color:e.$q.dark.mode?"grey300":"primary"},null,8,["color"])):(p(),L(F,{key:1},[n(V,{showing:a.loading,color:e.$q.dark.mode?"grey300":"primary"},null,8,["showing","color"]),n(Z,{onSubmit:o.checkForm},{default:c(()=>[R("div",ae,[R("div",ie,[n(X,{size:"70px"},{default:c(()=>[o.hasPhoto?(p(),b(Q,{key:0,src:a.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover"},null,8,["src"])):o.hasData?(p(),b(Q,{key:1,src:a.featured_url,"spinner-color":"primary","spinner-size":"sm",fit:"cover"},null,8,["src"])):x("",!0)]),_:1}),n(_,{round:"",color:"primary","text-color":"white",icon:"las la-camera",unelevated:"",size:"sm",class:"absolute-bottom-right",onClick:o.takePhoto},null,8,["onClick"])])]),a.upload_enabled?(p(),b(l,{key:0,ref:"uploader_file",path:"upload/avatar",onAfterUploadfile:o.afterUploadfile},null,8,["onAfterUploadfile"])):x("",!0),n(g,{modelValue:a.first_name,"onUpdate:modelValue":t[1]||(t[1]=s=>a.first_name=s),label:e.$t("First name"),"stack-label":"",rules:[s=>s&&s.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),n(g,{modelValue:a.last_name,"onUpdate:modelValue":t[2]||(t[2]=s=>a.last_name=s),label:e.$t("Last name"),"stack-label":"",rules:[s=>s&&s.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),n(g,{modelValue:a.email_address,"onUpdate:modelValue":t[3]||(t[3]=s=>a.email_address=s),label:e.$t("Email address"),"stack-label":"",rules:[s=>s&&s.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),n(g,{modelValue:a.mobile_number,"onUpdate:modelValue":t[4]||(t[4]=s=>a.mobile_number=s),label:e.$t("Mobile number"),"stack-label":"",prefix:a.mobile_prefix,mask:"##################",rules:[s=>s&&s.length>0||e.$t("This field is required"),s=>s.length<=15||e.$t("Please use maximum 15 characters")]},null,8,["modelValue","label","prefix","rules"]),n(J,{class:"q-pa-sm"}),n(K,{class:A(["q-pa-md bg-whitex row q-gutter-x-sm",{"bg-mydark":e.$q.dark.mode,"bg-white":!e.$q.dark.mode}])},{default:c(()=>[n(_,{color:e.$q.dark.mode?"grey":"dark","text-color":e.$q.dark.mode?"grey-9":"white",size:"lg",rounded:"",unelevated:"","no-caps":"",class:"col",onClick:t[5]||(t[5]=s=>e.$router.back())},{default:c(()=>[P(k(e.$t("Cancel")),1)]),_:1},8,["color","text-color"]),n(_,{type:"submit",color:"primary","text-color":"white",size:"lg",rounded:"",unelevated:"","no-caps":"",class:"col",loading:a.loading_submit},{default:c(()=>[P(k(e.$t("Save")),1)]),_:1},8,["loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])],64)),n(d,{ref:"verification",message:a.otp_message,back_button:!1,loading:a.loading_submit,onAfterVerify:o.afterVerify},null,8,["message","loading","onAfterVerify"])]),_:1})],64)}var se=M(te,[["render",re]]),_e=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{$ as E,_e as U};
