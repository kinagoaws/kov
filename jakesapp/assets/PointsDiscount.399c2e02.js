import{_ as S,O as w,X as i,m as l,Y as m,f as t,p as s,$ as b,as as k,a0 as u,a1 as q,S as _,R as d,n,Q as p,af as y,F as g,bh as C,bg as v,P as c,b8 as P,Z as D,ac as x,ag as V,bT as B,aX as T}from"./index.c5b868f5.js";import{Q as f}from"./QItemLabel.4665782c.js";import{Q as z}from"./QSkeleton.11b8074a.js";import{Q as A}from"./QList.9b7158f1.js";import{Q as U}from"./QSpace.24950ca6.js";import{Q as N}from"./QLinearProgress.05dc3008.js";import{Q as E}from"./QTab.efd359a5.js";import{Q as I}from"./QTabs.54389c7c.js";import{Q as L}from"./QForm.997d74f6.js";import{C as Q}from"./ClosePopup.32eeb9ff.js";import"./QResizeObserver.3ed5059f.js";import"./rtl.276c3f1b.js";const F={name:"PointsDiscount",props:["settings"],data(){return{loading:!1,points_enabled:!1,points_use_thresholds:!1,data:!1,modal:!1,points:0,data_points:[],balance:0,points_id:0,loading_apply:!1,loading_remove:!1,points_tab:0}},setup(){return{DataStorePersisted:w()}},mounted(){this.points_enabled=this.settings.points_enabled,this.points_use_thresholds=this.settings.points_use_thresholds,this.points_enabled&&this.getCartpoints()},computed:{hasDiscount(){return Object.keys(this.data).length>0?this.data.discount>0:!1}},methods:{getCartpoints(){this.loading=!0,i.fetchDataByTokenPost("getCartpoints","cart_uuid="+i.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()).then(e=>{this.data=e.details}).catch(e=>{this.data=[]}).then(e=>{this.loading=!1})},beforeShow(){this.points=0,this.points_use_thresholds&&this.getPointsthresholds()},Submit(){console.log("submit",this.points),this.loading_apply=!0,i.fetchDataByTokenPost("applyPoints","cart_uuid="+i.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()+"&points="+this.points+"&points_id="+this.points_id).then(e=>{this.modal=!1,this.getCartpoints(),this.$emit("afterApplypoints")}).catch(e=>{i.notify("dark",e,"error_outline",this.$q)}).then(e=>{this.loading_apply=!1})},removePoints(){this.loading_remove=!0,i.fetchDataByTokenPost("removePoints","cart_uuid="+i.getStorage("cart_uuid")).then(e=>{this.getCartpoints(),this.$emit("afterApplypoints")}).catch(e=>{i.notify("dark",e,"error_outline",this.$q)}).then(e=>{this.loading_remove=!1})},getPointsthresholds(){this.loading_points=!0,i.fetchDataByTokenPost("getPointsthresholds","cart_uuid="+i.getStorage("cart_uuid")+"&currency_code="+this.DataStorePersisted.getUseCurrency()).then(e=>{this.data_points=e.details.data,this.balance=e.details.balance}).catch(e=>{i.notify("dark",e,"error_outline",this.$q)}).then(e=>{this.loading_points=!1})},setPoints(){this.points=this.points_tab.points,this.points_id=this.points_tab.id}}},M={class:"text-h6 text-weight-bold"},O={class:"q-pa-md q-pt-none"},R={class:"text-caption"},X={class:"text-subtitle2 q-mb-sm"},j={key:0,class:"absolute-full flex flex-center"},Y={class:"text-white font12 text-weight-bold"};function Z(e,r,G,H,a,h){return l(),m(g,null,[t(A,{bordered:"",dense:"",class:"rounded-borders q-pt-xs q-pb-xs q-mb-sm"},{default:s(()=>[t(b,{clickable:"",onClick:r[0]||(r[0]=k(o=>a.modal=!0,["stop"]))},{default:s(()=>[t(u,{avatar:"",class:"item-column-less"},{default:s(()=>[t(q,{color:"primary","text-color":"white",icon:"las la-percentage",size:"md"})]),_:1}),t(u,null,{default:s(()=>[t(f,null,{default:s(()=>[_(d(e.$t("Points discount")),1)]),_:1})]),_:1}),t(u,{side:""},{default:s(()=>[h.hasDiscount?(l(),n(p,{key:0,flat:"",unelevated:"","no-caps":"",color:"negative",icon:"clear",round:"",size:"sm",loading:a.loading_remove,onClick:k(h.removePoints,["stop"])},null,8,["loading","onClick"])):(l(),n(p,{key:1,round:"",color:"yellow-9",icon:"add",flat:"",size:"sm"}))]),_:1})]),_:1}),t(b,{class:"item-normal-height"},{default:s(()=>[t(u,null,{default:s(()=>[a.loading?(l(),n(f,{key:0},{default:s(()=>[t(z,{recttype:"type",class:y({"bg-grey600":e.$q.dark.mode,"bg-mygrey":!e.$q.dark.mode})},null,8,["class"])]),_:1})):(l(),m(g,{key:1},[a.data.discount>0?(l(),n(f,{key:0,caption:"",class:"text-green"},{default:s(()=>[_(d(a.data.discount_label),1)]),_:1})):(l(),m(g,{key:1},[t(f,null,{default:s(()=>[_(d(a.data.redeem_discount),1)]),_:1}),t(f,{caption:"",class:"text-green"},{default:s(()=>[_(d(a.data.redeem_label),1)]),_:1})],64))],64))]),_:1})]),_:1})]),_:1}),t(T,{modelValue:a.modal,"onUpdate:modelValue":r[3]||(r[3]=o=>a.modal=o),persistent:"",position:"bottom","transition-show":"fade","transition-hide":"fadeout",onBeforeShow:h.beforeShow},{default:s(()=>[t(C,{class:y({"bg-grey600":e.$q.dark.mode,"bg-mygrey":!e.$q.dark.mode})},{default:s(()=>[t(L,{onSubmit:h.Submit},{default:s(()=>[t(v,{class:"row items-center q-pb-none"},{default:s(()=>[c("div",M,d(e.$t("Apply discount")),1),t(U),P(t(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[Q]])]),_:1}),t(v,{style:{"max-height":"50vh","min-height":"30vh"},class:"scroll q-pa-none"},{default:s(()=>[c("div",O,[c("div",{class:y(["radius10 q-mb-xs",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode,disabled:e.refresh}])},[a.points_use_thresholds?(l(),n(I,{key:0,modelValue:a.points_tab,"onUpdate:modelValue":[r[1]||(r[1]=o=>a.points_tab=o),h.setPoints],class:"text-dark q-mb-lg","no-caps":"","active-color":"white","active-bg-color":"primary","indicator-color":"transparent"},{default:s(()=>[(l(!0),m(g,null,D(a.data_points,o=>(l(),n(E,{key:o,name:o,disable:!(a.balance>o.points)},{default:s(()=>[c("div",R,d(o.label),1),c("div",X,d(o.amount),1),t(N,{size:"18px",value:a.balance/o.points,style:{"min-width":"70px"},class:"radius20",color:a.balance>=o.points?"yellow-9":"blue"},{default:s(()=>[a.balance>=o.points?(l(),m("div",j,[c("span",Y,d(e.$t("REDEEM")),1)])):x("",!0)]),_:2},1032,["value","color"])]),_:2},1032,["name","disable"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])):(l(),n(b,{key:1},{default:s(()=>[t(u,null,{default:s(()=>[t(V,{modelValue:a.points,"onUpdate:modelValue":r[2]||(r[2]=o=>a.points=o),label:e.$t("Enter points to convert to discount"),"stack-label":"",rules:[o=>o&&o.length>0||this.$t("This field is required"),o=>!isNaN(o)||this.$t("Please enter a numeric value")]},null,8,["modelValue","label","rules"])]),_:1}),t(u,{side:""},{default:s(()=>[t(p,{type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:e.$t("Apply"),size:"15px",loading:a.loading_apply},null,8,["label","loading"])]),_:1})]),_:1}))],2)])]),_:1}),t(B,null,{default:s(()=>[a.points_use_thresholds?(l(),n(p,{key:0,type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:e.$t("Apply"),size:"17px",disable:!(a.points>0)},null,8,["label","disable"])):P((l(),n(p,{key:1,unelevated:"",rounded:"",color:"red-2","text-color":"red-9","no-caps":"",class:"full-width",label:e.$t("Close"),size:"17px",loading:e.refresh},null,8,["label","loading"])),[[Q]])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class"])]),_:1},8,["modelValue","onBeforeShow"])],64)}var re=S(F,[["render",Z]]);export{re as default};
