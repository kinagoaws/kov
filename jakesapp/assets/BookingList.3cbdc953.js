import{_ as q,U as w,X as y,m as r,n as c,p as t,f as a,Q,S as g,R as l,af as S,bh as $,bg as B,$ as v,a0 as p,P as i,Y as u,Z as k,F as _,ac as b,bJ as T,ah as L}from"./index.c5b868f5.js";import{Q as P}from"./QToolbarTitle.4da9f270.js";import{Q as C}from"./QToolbar.9b15bf0e.js";import{Q as z}from"./QHeader.b374650f.js";import{Q as h}from"./QItemLabel.4665782c.js";import{Q as x}from"./QCircularProgress.1d7da185.js";import{Q as D}from"./QTab.efd359a5.js";import{Q as I}from"./QTabs.54389c7c.js";import{Q as V}from"./QImg.79fcc1c6.js";import{Q as N}from"./QBadge.f1da1480.js";import{Q as R}from"./QList.9b7158f1.js";import{Q as j}from"./QInnerLoading.ff23f6a9.js";import{Q as U}from"./QInfiniteScroll.e5ee4582.js";import{Q as F}from"./QPageScroller.9f5fda23.js";import{Q as Y}from"./QPage.528ab8a8.js";import{Q as A}from"./QPullToRefresh.85618661.js";import"./QResizeObserver.3ed5059f.js";import"./format.8ac60962.js";import"./rtl.276c3f1b.js";import"./use-page-sticky.ec3ca395.js";import"./TouchPan.5486290b.js";import"./touch.9135741d.js";import"./selection.65959ca5.js";const E={name:"BookingList",setup(){return{SettingStore:w()}},data(){return{data:[],loading:!1,tab:"all",tabList:[],page:0,is_refresh:void 0,balance:0,loading_balance:!0,merchant:[],table_list:[]}},mounted(){Object.keys(this.SettingStore.settings_data).length>0?this.SettingStore.settings_data.booking_enabled?(this.tabList=this.SettingStore.settings_data.booking_status_list,this.BookingSummary()):this.$router.push("/home"):this.$watch(()=>this.SettingStore.$state.settings_data,(e,m)=>{e.booking_enabled?(this.tabList=this.SettingStore.settings_data.booking_status_list,this.BookingSummary()):this.$router.push("/home")})},computed:{hasData(){return this.data.length>0},getData(){return this.data}},methods:{async refresh(e){await this.BookingSummary(),this.resetPagination(),e()},async BookingSummary(){this.loading_balance=!0,y.fetchDataPostTableToken("BookingSummary").then(e=>{e.code==1?this.balance=e.details.summary.total_reservation:this.balance=0}).catch(e=>{}).then(e=>{this.loading_balance=!1})},getTransactions(e,m){this.loading=!0,this.page=e,y.fetchDataPostTableToken("BookingList","page="+e+"&status="+this.tab+"&merchant_id="+this.SettingStore.settings_data.merchant_id).then(n=>{n.code==1?(this.data.push(n.details.data),this.merchant=n.details.merchant,this.table_list=n.details.table_list,n.details.end_results&&this.$refs.nscroll&&this.$refs.nscroll.stop()):this.$refs.nscroll&&this.$refs.nscroll.stop()}).catch(n=>{this.$refs.nscroll&&this.$refs.nscroll.stop()}).then(n=>{this.loading=!1,m(),y.empty(this.is_refresh)||this.is_refresh()})},tabChange(){this.resetPagination()},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()}}},H={class:"text-weight-bold text-body1"},J={key:1,class:"text-weight-bold text-yellow-9 text-h6"},O={class:"q-pl-md q-pr-md q-pt-sm"},X={class:"q-pl-md q-pr-md q-pb-xl"},Z={key:0,class:"card-form flex flex-center text-body2 text-grey"},G={key:1,class:"row justify-center absolute-bottom"},K={class:"q-pa-md flex flex-center"},M={class:"flex items-center q-gutter-x-sm"},W={class:"text-body2 text-grey"};function ee(e,m,n,te,o,f){return r(),c(A,{onRefresh:f.refresh},{default:t(()=>[a(z,{reveal:"",class:S({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:t(()=>[a(C,null,{default:t(()=>[a(Q,{onClick:m[0]||(m[0]=d=>e.$router.back()),round:"",dense:"",icon:"arrow_back",unelevated:"",color:e.$q.dark.mode?"grey":"mygrey","text-color":e.$q.dark.mode?"grey-9":"dark"},null,8,["color","text-color"]),a(P,{class:"text-weight-bold"},{default:t(()=>[g(l(e.$t("Bookings")),1)]),_:1})]),_:1})]),_:1},8,["class"]),a(Y,null,{default:t(()=>[a($,{flat:""},{default:t(()=>[a(B,{class:"q-pt-none q-pb-none"},{default:t(()=>[a(v,null,{default:t(()=>[a(p,null,{default:t(()=>[a(h,{class:"text-weight-bold"},{default:t(()=>[i("div",H,l(e.$t("Total Bookings")),1)]),_:1}),a(h,{caption:""},{default:t(()=>[g(l(e.$t("Your bookings reservations")),1)]),_:1})]),_:1}),a(p,{side:"",top:""},{default:t(()=>[a(h,null,{default:t(()=>[o.loading_balance?(r(),c(x,{key:0,indeterminate:"",rounded:"",size:"25px",color:"primary"})):(r(),u("div",J,l(o.balance),1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),i("div",O,[i("div",{class:S(["border-dark-greyx q-pa-xs radius20 q-mb-md",{"border-none bg-grey600":e.$q.dark.mode,"border-dark-grey":!e.$q.dark.mode}])},[a(I,{modelValue:o.tab,"onUpdate:modelValue":[m[1]||(m[1]=d=>o.tab=d),f.tabChange],dense:"",class:"text-grey","indicator-color":"transparent","active-color":"primary",align:"justify","narrow-indicator":"","no-caps":""},{default:t(()=>[(r(!0),u(_,null,k(o.tabList,(d,s)=>(r(),c(D,{key:d,name:s,label:d,"no-caps":"","content-class":"text-weight-500 "},null,8,["name","label"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])],2)]),i("div",X,[a(U,{ref:"nscroll",onLoad:f.getTransactions,offset:250},{default:t(()=>[f.hasData?(r(),c(R,{key:0,separator:""},{default:t(()=>[(r(!0),u(_,null,k(f.getData,d=>(r(),u(_,{key:d},[(r(!0),u(_,null,k(d,s=>(r(),c(v,{key:s.transaction_date,clickable:"",to:{path:"/reservation/track",query:{id:s.reservation_uuid}}},{default:t(()=>[o.merchant[s.merchant_id]?(r(),c(p,{key:0,avatar:""},{default:t(()=>[a(V,{src:o.merchant[s.merchant_id].url_logo,style:{width:"70px",height:"70px"},fit:"cover",loading:"lazy","spinner-color":"primary","spinner-size":"xs",class:"rounded-borders"},null,8,["src"])]),_:2},1024)):b("",!0),a(p,null,{default:t(()=>[o.merchant[s.merchant_id]?(r(),c(h,{key:0},{default:t(()=>[g(l(o.merchant[s.merchant_id].restaurant_name),1)]),_:2},1024)):b("",!0),a(h,{caption:""},{default:t(()=>[g(l(s.booking_id),1)]),_:2},1024),a(h,{caption:""},{default:t(()=>[g(l(s.reservation_date_raw),1)]),_:2},1024),a(h,null,{default:t(()=>[a(N,{rounded:"",label:s.status,class:"q-pl-sm q-pr-sm",style:T({"background-color":`${s.status_color.background}`,color:`${s.status_color.color}`})},null,8,["label","style"])]),_:2},1024)]),_:2},1024),a(p,{side:""},{default:t(()=>[a(L,{name:"chevron_right",size:"sm",color:"grey"})]),_:1})]),_:2},1032,["to"]))),128))],64))),128))]),_:1})):(r(),u(_,{key:1},[o.loading?b("",!0):(r(),u("div",Z,[i("div",null,l(e.$t("No available data")),1)]))],64))]),loading:t(()=>[o.page<=1?(r(),c(j,{key:0,showing:!0,color:"primary",size:"md"})):o.page>1?(r(),u("div",G,[i("div",K,[i("div",M,[i("div",null,[a(x,{indeterminate:"",rounded:"",size:"30px",color:"primary"})]),i("div",W,l(e.$t("loading")),1)])])])):b("",!0)]),_:1},8,["onLoad"])]),a(F,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:t(()=>[a(Q,{fab:"",icon:"keyboard_arrow_up",color:e.$q.dark.mode?"grey":"grey-2","text-color":e.$q.dark.mode?"grey-9":"grey",padding:"xs"},null,8,["color","text-color"])]),_:1})]),_:1})]),_:1},8,["onRefresh"])}var qe=q(E,[["render",ee]]);export{qe as default};
