import{t as Q,G as B,r,c as d,w as F,o as z,H as E,h as c,x as H,ah as I,a8 as L,aw as O,g as G,L as U,ax as V,J as j}from"./index.c5b868f5.js";import{T as D}from"./TouchPan.5486290b.js";import{b as J}from"./format.8ac60962.js";const s=40,h=20;var K=Q({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:B},emits:["refresh"],setup(l,{slots:x,emit:_}){const{proxy:n}=G(),{$q:b}=n,t=r("pull"),f=r(0),o=r(!1),v=r(-s),p=r(!1),T=r({}),C=d(()=>({opacity:f.value,transform:`translateY(${v.value}px) rotate(${f.value*360}deg)`})),P=d(()=>"q-pull-to-refresh__puller row flex-center"+(p.value===!0?" q-pull-to-refresh__puller--animating":"")+(l.bgColor!==void 0?` bg-${l.bgColor}`:""));function y(e){if(e.isFinal===!0){o.value===!0&&(o.value=!1,t.value==="pulled"?(t.value="refreshing",g({pos:h}),S()):t.value==="pull"&&g({pos:-s,ratio:0}));return}if(p.value===!0||t.value==="refreshing")return!1;if(e.isFirst===!0){if(U(w)!==0||e.direction!=="down")return o.value===!0&&(o.value=!1,t.value="pull",g({pos:-s,ratio:0})),!1;o.value=!0;const{top:R,left:M}=n.$el.getBoundingClientRect();T.value={top:R+"px",left:M+"px",width:window.getComputedStyle(n.$el).getPropertyValue("width")}}V(e.evt);const u=Math.min(140,Math.max(0,e.distance.y));v.value=u-s,f.value=J(u/(h+s),0,1);const i=v.value>h?"pulled":"pull";t.value!==i&&(t.value=i)}const $=d(()=>{const e={down:!0};return l.noMouse!==!0&&(e.mouse=!0),[[D,y,void 0,e]]}),q=d(()=>`q-pull-to-refresh__content${o.value===!0?" no-pointer-events":""}`);function S(){_("refresh",()=>{g({pos:-s,ratio:0},()=>{t.value="pull"})})}let w,a=null;function g({pos:e,ratio:u},i){p.value=!0,v.value=e,u!==void 0&&(f.value=u),a!==null&&clearTimeout(a),a=setTimeout(()=>{a=null,p.value=!1,i&&i()},300)}function m(){w=j(n.$el,l.scrollTarget)}return F(()=>l.scrollTarget,m),z(m),E(()=>{a!==null&&clearTimeout(a)}),Object.assign(n,{trigger:S,updateScrollTarget:m}),()=>{const e=[c("div",{class:q.value},H(x.default)),c("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:T.value},[c("div",{class:P.value,style:C.value},[t.value!=="refreshing"?c(I,{name:l.icon||b.iconSet.pullToRefresh.icon,color:l.color,size:"32px"}):c(L,{size:"24px",color:l.color})])])];return O("div",{class:"q-pull-to-refresh"},e,"main",l.disable===!1,()=>$.value)}}});export{K as Q};
