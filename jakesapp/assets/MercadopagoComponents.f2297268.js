import{Q as f}from"./QSpace.24950ca6.js";import{_ as $,X as s,m as C,Y as S,f as o,p as d,bh as g,af as b,bg as h,P as l,R as m,b8 as v,Q as p,ag as n,bd as x,bT as q,aX as w,F as Q}from"./index.c5b868f5.js";import{Q as B}from"./QSelect.65ab904e.js";import{Q as k}from"./QForm.997d74f6.js";import{C as P}from"./ClosePopup.32eeb9ff.js";import{l as M}from"./index.4f152a18.js";import"./QItemLabel.4665782c.js";import"./QMenu.b5349f2e.js";import"./selection.65959ca5.js";import"./rtl.276c3f1b.js";import"./format.8ac60962.js";let c;const U={name:"MercadopagoComponents",props:["title","label","payment_code","payment_credentials"],data(){return{show_modal:!1,data:[],loading:!1,credentials:[],identification_type_list:[],identification_type:"",identification_number:"",credit_card_number:"",expiry_date:"",cvv:"",card_name:"",customer_id:"",payment_uuid:"",order_uuid:"",modal_cvv:!1,card_number:"",verify_cvv:""}},methods:{showPaymentForm(){this.show_modal=!0,this.setCredentials(),this.includeScript(!0)},close(){this.show_modal=!1},closePayment(){this.$emit("afterCancelPayment")},setCredentials(){typeof this.payment_credentials[this.payment_code]!="undefined"&&this.payment_credentials[this.payment_code]!==null&&(this.credentials=this.payment_credentials[this.payment_code])},includeScript(e){M("https://sdk.mercadopago.com/js/v2").then(()=>{e&&(this.initPayment(),this.createCustomer())}).catch(t=>{console.log("error",t)})},initPayment(){c=new MercadoPago(this.credentials.attr2),this.identification_type_list=[],c.getIdentificationTypes().then(e=>{Object.entries(e).forEach(([t,a])=>{this.identification_type_list.push({label:a.name,value:a.id})})}).catch(e=>{s.notify("dark",e.message,"error_outline",this.$q)})},createCustomer(){const e={payment_code:this.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type};this.loading=!0,s.PaymentPost("MercadopagoCustomer",e).then(t=>{this.customer_id=t.details.customer_id}).catch(t=>{s.notify("dark",t,"error_outline",this.$q)}).then(t=>{this.loading=!1})},onSubmit(){var e=this.expiry_date,t=e.split("/"),a=t[0],_=t[1];const u=this.credit_card_number.replace(/ /g,"");this.is_loading=!0,c.createCardToken({cardNumber:u,cardholderName:this.card_name,cardExpirationMonth:a,cardExpirationYear:_,securityCode:this.cvv,identificationType:this.identification_type,identificationNumber:this.identification_number}).then(i=>{this.AddCard(i)}).catch(i=>{if(this.is_loading=!1,typeof i.message!="undefined"&&i.message!==null)s.notify("dark",i.message,"error_outline",this.$q);else{let y;y.forEach((V,O)=>{y+=V.message}),s.notify("dark",y,"error_outline",this.$q)}})},AddCard(e){let t={payment_code:this.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type,id:e.id,card_name:this.card_name,customer_id:this.customer_id};this.loading=!0,s.PaymentPost("MercadopagoAddcard",t).then(a=>{this.close(),this.$emit("afterAddpayment")}).catch(a=>{s.notify("dark",a,"error_outline",this.$q)}).then(a=>{this.loading=!1})},PaymentRender(e){this.payment_uuid=e.payment_uuid,this.order_uuid=e.order_uuid;let t={payment_uuid:this.payment_uuid};s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("MercadopagoGetcard",t).then(a=>{this.card_number=a.details.card_number,this.card_id=a.details.card_id,this.includeScript(!1),this.setCredentials(),this.modal_cvv=!0}).catch(a=>{s.notify("dark",a,"error_outline",this.$q)}).then(a=>{s.hideLoadingBox(this.$q)})},SubmitPayment(){this.loading=!0,c=new MercadoPago(this.credentials.attr2),c.createCardToken({cardId:this.card_id,securityCode:this.verify_cvv}).then(e=>{this.loading=!1,s.empty(this.jwt_data)?this.capturePayment(e.id):this.processPayment(e.id)}).catch(e=>{if(this.loading=!1,typeof e.message!="undefined"&&e.message!==null)s.notify("dark",e.message,"error_outline",this.$q);else{let t;e.forEach((a,_)=>{t+=a.message}),s.notify("dark",t,"error_outline",this.$q)}})},capturePayment(e){var t={payment_code:this.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type,order_uuid:this.order_uuid,cart_uuid:s.getStorage("cart_uuid"),payment_uuid:this.payment_uuid,card_token:e};s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("MercadopagoCapturePayment",t).then(a=>{this.$emit("afterSuccessfulpayment",a.details)}).catch(a=>{s.notify("dark",a,"error_outline",this.$q)}).then(a=>{s.hideLoadingBox(this.$q)})},Dopayment(e,t){this.jwt_data=e,s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("MercadopagoGetcardid",{payment_uuid:t.payment_uuid}).then(a=>{this.setCredentials(),this.includeScript(),this.card_number=a.details.card_number,this.card_id=a.details.card_id,this.error=[],this.$emit("closePayment"),this.modal_cvv=!0}).catch(a=>{s.notify("dark",a,"error",this.$q)}).then(a=>{s.hideLoadingBox(this.$q)})},processPayment(e){s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("MercadopagoProcesspayment",{card_token:e,data:this.jwt_data}).then(t=>{this.modal_cvv=!1,this.$emit("afterSuccessfulpayment",t.details)}).catch(t=>{s.notify("dark",t,"error",this.$q)}).then(t=>{s.hideLoadingBox(this.$q)})}}},E={class:"text-h5 text-weight-bold"},L={class:"text-body2 q-mb-md"},A={class:"column q-col-gutter-sm"},I={class:"row q-col-gutter-md"},N={class:"col"},T={class:"col"},j={class:"row q-col-gutter-md"},D={class:"col-12"},F={class:"row q-col-gutter-md"},z={class:"col"},G={class:"col"},R={class:"text-h5 text-weight-bold"},X={class:"text-body2 q-mb-md"};function Y(e,t,a,_,r,u){return C(),S(Q,null,[o(w,{modelValue:r.show_modal,"onUpdate:modelValue":t[6]||(t[6]=i=>r.show_modal=i),persistent:"","transition-show":"scale","transition-hide":"scale",position:this.$q.screen.gt.sm?"standard":"bottom","full-width":!this.$q.screen.gt.sm},{default:d(()=>[o(g,{class:b({"bg-grey600 text-white":e.$q.dark.mode})},{default:d(()=>[o(h,{class:"row items-center q-pb-none"},{default:d(()=>[l("div",E,m(a.title),1),o(f),v(o(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[P]])]),_:1}),o(k,{onSubmit:u.onSubmit},{default:d(()=>[o(h,{class:"q-pa-md"},{default:d(()=>[l("div",L,m(a.label.notes),1),l("div",A,[o(n,{color:"primary","stack-label":"",modelValue:r.credit_card_number,"onUpdate:modelValue":t[0]||(t[0]=i=>r.credit_card_number=i),label:e.$t("Card number"),rules:[i=>i&&i.length>0||e.$t("this field is required")],mask:"#### #### #### ####"},null,8,["modelValue","label","rules"])]),l("div",I,[l("div",N,[o(n,{color:"primary","stack-label":"",modelValue:r.expiry_date,"onUpdate:modelValue":t[1]||(t[1]=i=>r.expiry_date=i),label:e.$t("Exp. date"),class:"no-margin",rules:[i=>i&&i.length>0||e.$t("this field is required")],mask:"##/##"},null,8,["modelValue","label","rules"])]),l("div",T,[o(n,{color:"primary","stack-label":"",modelValue:r.cvv,"onUpdate:modelValue":t[2]||(t[2]=i=>r.cvv=i),label:e.$t("Security Code"),class:"no-margin",rules:[i=>i&&i.length>0||e.$t("this field is required")],mask:"####"},null,8,["modelValue","label","rules"])])]),l("div",j,[l("div",D,[o(n,{color:"primary","stack-label":"",modelValue:r.card_name,"onUpdate:modelValue":t[3]||(t[3]=i=>r.card_name=i),class:"no-margin",label:e.$t("Card name"),rules:[i=>i&&i.length>0||e.$t("this field is required")]},null,8,["modelValue","label","rules"])])]),l("div",F,[l("div",z,[o(B,{modelValue:r.identification_type,"onUpdate:modelValue":t[4]||(t[4]=i=>r.identification_type=i),options:r.identification_type_list,label:e.$t("Identitification Type"),color:"primary","stack-label":""},null,8,["modelValue","options","label"])]),l("div",G,[o(n,{color:"primary","stack-label":"",modelValue:r.identification_number,"onUpdate:modelValue":t[5]||(t[5]=i=>r.identification_number=i),label:e.$t("Identification Number"),class:"no-margin",rules:[i=>i&&i.length>0||e.$t("this field is required")],mask:"####"},null,8,["modelValue","label","rules"])])])]),_:1}),o(x,{spaced:""}),o(q,null,{default:d(()=>[o(p,{type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width q-mb-sm",label:a.label.submit,size:"lg",loading:r.loading},null,8,["label","loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class"])]),_:1},8,["modelValue","position","full-width"]),o(w,{modelValue:r.modal_cvv,"onUpdate:modelValue":t[8]||(t[8]=i=>r.modal_cvv=i),"transition-show":"fade","transition-hide":"fadeout",position:this.$q.screen.gt.sm?"standard":"bottom","full-width":!this.$q.screen.gt.sm},{default:d(()=>[o(g,{class:b({"bg-grey600 text-white":e.$q.dark.mode})},{default:d(()=>[o(h,{class:"row items-center q-pb-none"},{default:d(()=>[l("div",R,m(e.$t("Verification")),1),o(f),v(o(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[P]])]),_:1}),o(k,{onSubmit:u.SubmitPayment},{default:d(()=>[o(h,{class:"q-pa-md"},{default:d(()=>[l("div",X,m(e.$t("Enter CVV for card"))+" "+m(r.card_number),1),o(n,{dense:"",color:"primary","stack-label":"",modelValue:r.verify_cvv,"onUpdate:modelValue":t[7]||(t[7]=i=>r.verify_cvv=i),label:e.$t("Security Code"),class:"no-margin",rules:[i=>i&&i.length>0||e.$t("this field is required")],mask:"####"},null,8,["modelValue","label","rules"])]),_:1}),o(q,null,{default:d(()=>[o(p,{type:"submit",unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width q-mb-sm",label:e.$t("Submit"),size:"lg",loading:r.loading},null,8,["label","loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class"])]),_:1},8,["modelValue","position","full-width"])],64)}var re=$(U,[["render",Y]]);export{re as default};
