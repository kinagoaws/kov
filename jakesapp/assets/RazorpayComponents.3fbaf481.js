import{Q as p}from"./QSpace.24950ca6.js";import{_,X as s,m as u,n as f,p as r,f as i,bh as g,af as P,bg as d,P as c,R as h,b8 as $,Q as l,bd as z,bT as w,aX as C}from"./index.c5b868f5.js";import{C as q}from"./ClosePopup.32eeb9ff.js";import{l as m}from"./index.4f152a18.js";const b={name:"RazorpayComponents",props:["title","label","payment_code","payment_credentials"],data(){return{show_modal:!1,data:[],loading:!1,credentials:[],orders:[]}},methods:{showPaymentForm(){this.show_modal=!0,this.setCredentials()},close(){this.show_modal=!1},closePayment(){this.$emit("afterCancelPayment")},setCredentials(){typeof this.payment_credentials[this.payment_code]!="undefined"&&this.payment_credentials[this.payment_code]!==null&&(this.credentials=this.payment_credentials[this.payment_code])},onSubmit(){const e={payment_code:this.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type};this.loading=!0,s.PaymentPost("RazorpayCreateCustomer",e).then(t=>{this.close(),this.$emit("afterAddpayment")}).catch(t=>{s.notify("dark",t,"error_outline",this.$q)}).then(t=>{this.loading=!1})},PaymentRender(e){this.setCredentials(),this.data=e;const t={cart_uuid:e.cart_uuid,order_uuid:e.order_uuid,payment_code:e.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type};s.showLoadingBox(this.$t("getting_payment_info"),this.$q),s.PaymentPost("RazorpayCreateOrder",t).then(a=>{this.orders=a.details,this.initRazorPay()}).catch(a=>{s.notify("dark",a,"error_outline",this.$q)}).then(a=>{s.hideLoadingBox(this.$q)})},initRazorPay(){m("https://checkout.razorpay.com/v1/checkout.js").then(()=>{this.initPayment()}).catch(()=>{s.notify("dark",this.$t("failed loading script"),"error_outline",this.$q)})},initPayment(){try{const e={key:this.credentials.attr2,amount:this.orders.amount,currency:this.orders.currency,name:this.orders.name,description:this.orders.description,order_id:this.orders.order_id,customer_id:this.orders.customer_id,handler:a=>{this.verifyPayment(a)},theme:{color:"#3399cc"},modal:{ondismiss:a=>{this.closePayment()}}},t=new Razorpay(e);t.on("payment.failed",a=>{}),t.open()}catch(e){s.notify("dark",e,"error_outline",this.$q)}},verifyPayment(e){this.setCredentials();var t={cart_uuid:this.data.cart_uuid,order_uuid:this.data.order_uuid,payment_code:this.data.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type,razorpay_payment_id:e.razorpay_payment_id,razorpay_order_id:e.razorpay_order_id,razorpay_signature:e.razorpay_signature};s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("RazorpayVerifyPayment",t).then(a=>{this.$emit("afterSuccessfulpayment",a.details)}).catch(a=>{s.notify("dark",a,"error_outline",this.$q)}).then(a=>{s.hideLoadingBox(this.$q)})},Dopayment(e,t){this.jwt_data=e,this.force_amount=t.amount,this.force_currency=t.currency_code,this.setCredentials(),s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("Razorpaycreateneworder",{data:e}).then(a=>{this.orders=a.details,this.RazorPayinit()}).catch(a=>{this.$emit("afterCancelPayment",a)}).then(a=>{s.hideLoadingBox(this.$q)})},RazorPayinit(){m("https://checkout.razorpay.com/v1/checkout.js").then(()=>{this.Paymentinit()}).catch(()=>{s.notify("negative","failed loading script","error_outline",this.$q)})},Paymentinit(){try{let t={key:this.credentials.attr2,amount:this.orders.amount,currency:this.orders.currency,name:this.orders.name,description:this.orders.description,order_id:this.orders.order_id,customer_id:this.orders.customer_id,handler:a=>{this.processPayment(a)},theme:{color:"#3399cc"},modal:{ondismiss:a=>{this.closePayment()}}};var e=new Razorpay(t);e.on("payment.failed",a=>{}),this.$emit("closeLoader"),e.open()}catch(t){this.$emit("afterCancelPayment",t.message)}},processPayment(e){s.showLoadingBox(this.$t("processing_payment"),this.$q),s.PaymentPost("Razorpayprocesspayment",{data:this.jwt_data,razorpay_payment_id:e.razorpay_payment_id,razorpay_order_id:e.razorpay_order_id,razorpay_signature:e.razorpay_signature}).then(t=>{this.$emit("afterSuccessfulpayment",t.details)}).catch(t=>{this.$emit("afterCancelPayment",t)}).then(t=>{s.hideLoadingBox(this.$q)})}}},x={class:"text-h6 text-weight-bold"},k={class:"text-body2"};function R(e,t,a,v,o,y){return u(),f(C,{modelValue:o.show_modal,"onUpdate:modelValue":t[1]||(t[1]=n=>o.show_modal=n),persistent:"","transition-show":"scale","transition-hide":"scale",position:this.$q.screen.gt.sm?"standard":"bottom","full-width":!this.$q.screen.gt.sm},{default:r(()=>[i(g,{class:P({"bg-grey600 text-white":e.$q.dark.mode})},{default:r(()=>[i(d,{class:"row items-center q-pb-none"},{default:r(()=>[c("div",x,h(a.title),1),i(p),$(i(l,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])]),_:1}),i(d,{class:"q-pa-md"},{default:r(()=>[c("div",k,h(a.label.notes),1)]),_:1}),i(z,{spaced:""}),i(w,null,{default:r(()=>[i(l,{unelevated:"",rounded:"",color:"primary","text-color":"white","no-caps":"",class:"full-width q-mb-sm",label:a.label.submit,size:"lg",loading:o.loading,onClick:t[0]||(t[0]=n=>y.onSubmit())},null,8,["label","loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","position","full-width"])}var V=_(b,[["render",R]]);export{V as default};
