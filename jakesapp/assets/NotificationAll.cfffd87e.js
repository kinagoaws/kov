import{ay as S,az as b,I as A,aA as B,aB as Q,aE as q,aF as C,al as V,_ as I,X as y,m as a,Y as u,f as r,p as d,n as g,ac as v,F as c,af as w,Q as k,S as D,R as f,P as m,Z as N,ah as $,b8 as z,$ as L,a0 as x,bc as H}from"./index.c5b868f5.js";import{Q as j}from"./QToolbarTitle.4da9f270.js";import{Q as F}from"./QToolbar.9b15bf0e.js";import{Q as O}from"./QHeader.b374650f.js";import{Q as R}from"./QImg.79fcc1c6.js";import{Q as E}from"./QBadge.f1da1480.js";import{Q as M}from"./QSlideItem.d86a998c.js";import{Q as U}from"./QList.9b7158f1.js";import{Q as X}from"./QInnerLoading.ff23f6a9.js";import{Q as Y}from"./QCircularProgress.1d7da185.js";import{Q as Z}from"./QInfiniteScroll.e5ee4582.js";import{Q as G}from"./QPageScroller.9f5fda23.js";import{Q as J}from"./QPage.528ab8a8.js";import{Q as K}from"./QPullToRefresh.85618661.js";import{Q as W}from"./QTab.efd359a5.js";import{Q as ee}from"./QTabs.54389c7c.js";import{Q as te}from"./QFooter.51024c6d.js";import{c as T}from"./selection.65959ca5.js";import"./QResizeObserver.3ed5059f.js";import"./TouchPan.5486290b.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";import"./format.8ac60962.js";import"./use-page-sticky.ec3ca395.js";import"./rtl.276c3f1b.js";var oe=S({name:"touch-hold",beforeMount(e,o){const{modifiers:n}=o;if(n.mouse!==!0&&b.has.touch!==!0)return;const t={handler:o.value,noop:A,mouseStart(i){typeof t.handler=="function"&&B(i)===!0&&(Q(t,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),t.start(i,!0))},touchStart(i){if(i.target!==void 0&&typeof t.handler=="function"){const l=i.target;Q(t,"temp",[[l,"touchmove","move","passiveCapture"],[l,"touchcancel","end","notPassiveCapture"],[l,"touchend","end","notPassiveCapture"]]),t.start(i)}},start(i,l){t.origin=q(i);const h=Date.now();b.is.mobile===!0&&(document.body.classList.add("non-selectable"),T(),t.styleCleanup=p=>{t.styleCleanup=void 0;const _=()=>{document.body.classList.remove("non-selectable")};p===!0?(T(),setTimeout(_,10)):_()}),t.triggered=!1,t.sensitivity=l===!0?t.mouseSensitivity:t.touchSensitivity,t.timer=setTimeout(()=>{t.timer=void 0,T(),t.triggered=!0,t.handler({evt:i,touch:l!==!0,mouse:l===!0,position:t.origin,duration:Date.now()-h})},t.duration)},move(i){const{top:l,left:h}=q(i);t.timer!==void 0&&(Math.abs(h-t.origin.left)>=t.sensitivity||Math.abs(l-t.origin.top)>=t.sensitivity)&&(clearTimeout(t.timer),t.timer=void 0)},end(i){C(t,"temp"),t.styleCleanup!==void 0&&t.styleCleanup(t.triggered),t.triggered===!0?i!==void 0&&V(i):t.timer!==void 0&&(clearTimeout(t.timer),t.timer=void 0)}},s=[600,5,7];if(typeof o.arg=="string"&&o.arg.length!==0&&o.arg.split(":").forEach((i,l)=>{const h=parseInt(i,10);h&&(s[l]=h)}),[t.duration,t.touchSensitivity,t.mouseSensitivity]=s,e.__qtouchhold=t,n.mouse===!0){const i=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";Q(t,"main",[[e,"mousedown","mouseStart",`passive${i}`]])}b.has.touch===!0&&Q(t,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchend","noop","notPassiveCapture"]])},updated(e,o){const n=e.__qtouchhold;n!==void 0&&o.oldValue!==o.value&&(typeof o.value!="function"&&n.end(),n.handler=o.value)},beforeUnmount(e){const o=e.__qtouchhold;o!==void 0&&(C(o,"main"),C(o,"temp"),o.timer!==void 0&&clearTimeout(o.timer),o.styleCleanup!==void 0&&o.styleCleanup(),delete e.__qtouchhold)}});const ie={name:"NotificationsPage",data(){return{loading:!0,data:[],page:0,data_done:!1,is_refresh:void 0,hold:!1,notification_uuids:[],tab:"delete"}},watch:{hold(e,o){e||(this.notification_uuids=[])}},computed:{hasData(){return Object.keys(this.data).length>0},itemToDelete(){return Object.keys(this.notification_uuids).length}},methods:{refresh(e){this.resetPagination(),this.is_refresh=e},getNotifications(e,o){this.loading=!0,this.page=e,y.fetchDataByTokenPost("getNotification","page="+e).then(n=>{this.data.push(n.details.data),n.details.end_results&&this.$refs.nscroll&&this.$refs.nscroll.stop()}).catch(n=>{this.data_done=!0,y.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(n=>{o(),this.loading=!1,y.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},deleteNotification(e,o,n){this.data[e].splice(o,1),y.fetchDataByTokenPost("deleteNotification","uuid="+n.notification_uuid).then(t=>{})},handleHold(e){this.hold=!0},resetHold(){this.hold=!1,this.notification_uuids=[]},deleteAllNotification(){y.fetchDataByTokenPost("deleteAllNotification",{notification_uuids:this.notification_uuids}).then(e=>{this.hold=!1,this.resetPagination()}).catch(e=>{}).then(e=>{})},deleteAll(){this.$q.dialog({title:this.$t("Delete all"),message:this.$t("Are you sure want to delete all notifications?"),transitionShow:"fade",transitionHide:"fade",ok:{unelevated:!0,color:"primary",rounded:!1,"text-color":"white",size:"md",label:this.$t("Okay"),"no-caps":!0}}).onOk(()=>{y.fetchDataByTokenPost("deleteNotifications",{}).then(e=>{this.hold=!1,this.resetPagination()}).catch(e=>{}).then(e=>{})}).onCancel(()=>{}).onDismiss(()=>{})}}},ae={class:"text-weight-bold"},se={class:"ellipsis-3-lines text-grey-6"},re={key:1,class:"row justify-center absolute-bottom"},le={class:"q-pa-md flex flex-center"},ne={class:"flex items-center q-gutter-x-sm"},de={class:"text-body2 text-grey"},ue={key:0,class:"row justify-center q-my-sm"},ce={class:"font12 text-grey"},fe={key:1,class:"full-width text-center"},me={class:"text-weight-medium font15"},he={class:"text-grey font12"};function pe(e,o,n,t,s,i){return a(),u(c,null,[r(K,{onRefresh:i.refresh},{default:d(()=>[r(O,{class:w({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:d(()=>[r(F,null,{default:d(()=>[r(k,{onClick:o[0]||(o[0]=l=>e.$router.back()),round:"",dense:"",icon:"arrow_back",unelevated:"",color:e.$q.dark.mode?"grey":"mygrey","text-color":e.$q.dark.mode?"grey-9":"dark"},null,8,["color","text-color"]),r(j,{class:"text-weight-bold"},{default:d(()=>[s.hold?(a(),u(c,{key:0},[D(f(i.itemToDelete)+" "+f(e.$t("selected")),1)],64)):(a(),u(c,{key:1},[D(f(e.$t("Notifications")),1)],64))]),_:1}),s.hold?(a(),g(k,{key:0,onClick:o[1]||(o[1]=l=>s.hold=!1),flat:"",round:"",dense:"",icon:"close",color:e.$q.dark.mode?"white":"dark"},null,8,["color"])):(a(),u(c,{key:1},[i.hasData?(a(),g(k,{key:0,onClick:i.deleteAll,round:"",dense:"",icon:"o_delete",color:"red-2","text-color":"red-9",unelevated:""},null,8,["onClick"])):v("",!0)],64))]),_:1})]),_:1},8,["class"]),r(J,{class:w(["q-pa-md",{"flex flex-center":!i.hasData&&!s.loading}])},{default:d(()=>[r(Z,{ref:"nscroll",onLoad:i.getNotifications,offset:250},{loading:d(()=>[s.page<=1?(a(),g(X,{key:0,showing:!0,color:"primary",size:"md"})):s.page>1?(a(),u("div",re,[m("div",le,[m("div",ne,[m("div",null,[r(Y,{indeterminate:"",rounded:"",size:"30px",color:"primary"})]),m("div",de,f(e.$t("loading")),1)])])])):v("",!0)]),default:d(()=>[r(U,null,{default:d(()=>[(a(!0),u(c,null,N(s.data,(l,h)=>(a(),u(c,{key:l},[(a(!0),u(c,null,N(l,(p,_)=>(a(),g(M,{key:p,onAction:P=>i.deleteNotification(h,_,p),"right-color":"red",class:"q-mb-sm radius10"},{right:d(()=>[r(k,{round:"",color:"primary",icon:"delete_outline",unelevated:"",size:"sm"})]),default:d(()=>[z((a(),g(L,{tag:"label",class:w(["q-pa-sm bg-mygreyx radius10",{"bg-grey600 text-grey300":e.$q.dark.mode,"bg-mygrey text-dark":!e.$q.dark.mode}])},{default:d(()=>[r(x,{avatar:""},{default:d(()=>[s.hold?(a(),g(H,{key:0,modelValue:s.notification_uuids,"onUpdate:modelValue":o[2]||(o[2]=P=>s.notification_uuids=P),val:p.notification_uuid},null,8,["modelValue","val"])):(a(),g(R,{key:1,src:p.image,style:{width:"70px",height:"70px"},fit:"cover",loading:"lazy","spinner-color":"primary","spinner-size":"xs",class:"rounded-borders"},null,8,["src"]))]),_:2},1024),r(x,null,{default:d(()=>[m("div",ae,f(p.date),1),m("div",se,f(p.message),1)]),_:2},1024),r(x,{side:""},{default:d(()=>[r(E,{rounded:"",color:e.$q.dark.mode?"grey600":"mygrey"},null,8,["color"])]),_:1})]),_:2},1032,["class"])),[[oe,i.handleHold,void 0,{mouse:!0}]])]),_:2},1032,["onAction"]))),128))],64))),128))]),_:1})]),_:1},8,["onLoad"]),s.loading?v("",!0):(a(),u(c,{key:0},[i.hasData?(a(),u(c,{key:0},[s.data_done&&s.data.length>=10?(a(),u("div",ue,[m("p",ce,f(e.$t("end of results")),1)])):v("",!0)],64)):(a(),u("div",fe,[r($,{name:"history",size:"70px",color:"grey-3"}),m("div",me,f(e.$t("No new notifications")),1),m("div",he,f(e.$t("pull down to refresh")),1)]))],64)),r(G,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:d(()=>[r(k,{fab:"",icon:"keyboard_arrow_up",color:"dark",padding:"xs"})]),_:1})]),_:1},8,["class"])]),_:1},8,["onRefresh"]),s.hold&&i.itemToDelete>0?(a(),g(te,{key:0,class:"bg-lightprimary"},{default:d(()=>[r(ee,{modelValue:s.tab,"onUpdate:modelValue":o[3]||(o[3]=l=>s.tab=l),class:"text-grey-8","no-caps":"",dense:"",shrink:"","narrow-indicator":"",stretch:"",align:"left",breakpoint:0,"indicator-color":"dark"},{default:d(()=>[r(W,{name:"delete",icon:"delete",label:e.$t("Delete"),onClick:i.deleteAllNotification},null,8,["label","onClick"])]),_:1},8,["modelValue"])]),_:1})):v("",!0)],64)}var Fe=I(ie,[["render",pe]]);export{Fe as default};
