import{ar as c,X as r,V as o,ae as _,O as n}from"./index.c5b868f5.js";let i=[],d=[];const u=c("CartData",{state:()=>({cart_loading:!0,first_cart_loading:!0,items_count:0,cart_items:[],cart_summary:[],cart_total:[],error:[],cart_subtotal:[],cart_uuid:"",refresh_done:void 0,trans_loading:!0,trans_data:[],deliverytimes_loading:!1,deliverytimes_data:[],delivery_date_list:[],delivery_time_list:[],delivery_date:"",delivery_time:"",whento_deliver:"",checkout_address_loading:!1,checkout_address:[],order_loading:!1,order_data:[],loading_storeopen:!1,data_storeopen:[],storeopen_error:"",similar_loading:!1,similar_data:[],menu_loading:!1,data_category:[],data_items:[],items_not_available:[],category_not_available:[],cartcount_loading:!1,cartcount_data:[],dish:[],home_view_items:!1}),getters:{hasCart(t){return t.items_count>0},isCartError(t){return t.items_count>0&&Object.keys(this.error).length>0},getCartErrors(t){return t.error},hasOrderDetails(){return Object.keys(this.order_data).length>0},isClose(t){return!r.empty(t.storeopen_error)&&!t.loading_storeopen},getCartSubTotal(t){if(t.cart_subtotal)return t.cart_subtotal},getCartSubTotalValue(t){if(t.cart_subtotal)return t.cart_subtotal.value},getCartTotal(t){if(t.cart_total)return t.cart_total.value}},actions:{async getCart(t){try{this.cart_loading=!0;const a=await o.post("getCart",t);if(a.data.code==1){const e=a.data.details;return this.items_count=e.items_count,this.cart_uuid=e.cart_uuid,this.cart_items=e.data.items,this.cart_summary=e.data.summary,this.cart_total=e.data.total,this.error=e.error,this.cart_subtotal=e.data.subtotal,this.cartcount_data={items_count:e.items_count,subtotal:e.data.subtotal},!0}else return this.items_count=0,this.cart_uuid="",this.cart_items=[],this.cart_summary=[],this.cart_total=[],this.error=[],this.cart_subtotal=[],!1}catch(a){return console.error("Error fetching data:",a),this.cartcount_data={items_count:0,subtotal:{raw:0}},a}finally{this.cart_loading=!1}},async getCartCheckout(t){try{this.cart_loading=!0;const a=await o.post("getCartCheckout",t,{headers:{"Content-Type":"application/json",Authorization:`token ${_.getToken()}`}});if(a.data.code==1){const e=a.data.details;return this.items_count=e.items_count,this.cart_uuid=e.cart_uuid,this.cart_items=e.data.items,this.cart_summary=e.data.summary,this.cart_total=e.data.total,this.error=e.error,this.cart_subtotal=e.data.subtotal,!0}else return this.items_count=0,this.cart_uuid="",this.cart_items=[],this.cart_summary=[],this.cart_total=[],this.error=[],this.cart_subtotal=[],!1}catch(a){return console.error("Error fetching data:",a),a}finally{this.cart_loading=!1}},TransactionInfo(t){this.trans_loading=!0,r.fetchDataPost("TransactionInfo",t).then(a=>{this.trans_data=a.details}).catch(a=>{this.trans_data=[]}).then(a=>{this.trans_loading=!1})},clearDeliveryList(){this.delivery_date_list=[],this.delivery_time_list=[]},getDeliveryTimes(t){this.clearDeliveryList(),this.deliverytimes_loading=!0,r.fetchDataPost("getDeliveryTimes","cart_uuid="+t).then(a=>{Object.keys(a.details.opening_hours).length>0&&Object.entries(a.details.opening_hours.dates).forEach(([s,l])=>{this.delivery_date_list.push({label:l.name,value:l.value})}),d=a.details.opening_hours.dates,i=a.details.opening_hours.time_ranges;const e=Object.keys(d);if(this.delivery_date=e[0],this.getTimeList(this.delivery_date),!r.empty(i[this.delivery_date])){const s=i[this.delivery_date][0];this.delivery_time={label:s.pretty_time,value:s.end_time,start_time:s.start_time,end_time:s.end_time,pretty_time:s.pretty_time}}if(!r.empty(this.trans_data.delivery_date)){this.delivery_date=this.trans_data.delivery_date;const s=JSON.parse(this.trans_data.delivery_time);Object.keys(s).length>0&&(this.delivery_time=s)}}).catch(a=>{console.debug(a)}).then(a=>{this.deliverytimes_loading=!1})},getTimeList(t){r.empty(i[t])||Object.entries(i[t]).forEach(([a,e])=>{this.delivery_time_list.push({label:e.pretty_time,value:e.end_time,start_time:e.start_time,end_time:e.end_time,pretty_time:e.pretty_time})})},checkoutAddress(){this.checkout_address_loading=!0,r.fetchDataByTokenPost("checkoutAddress","place_id="+r.getStorage("local_id")).then(t=>{this.checkout_address=t.details.data}).catch(t=>{this.checkout_address=[]}).then(t=>{this.checkout_address_loading=!1})},hasCartError(){return this.items_count>0&&!this.cart_loading&&Object.keys(this.error).length>0},getCartError(){let t="";return this.items_count>0&&!this.cart_loading&&Object.keys(this.error).length>0&&Object.entries(this.error).forEach(([a,e])=>{t+=e+"<br/>"}),t},getOrder(t){this.order_loading=!0,r.fetchDataByTokenPost("getOrder","order_uuid="+t).then(a=>{this.order_data=a.details}).catch(a=>{this.order_data=[]}).then(a=>{this.order_loading=!1})},async checkStoreOpen(t){try{this.loading_storeopen=!0,(await o.post("/checkStoreOpen",t)).data.code==1}catch(a){console.error("Error fetching data:",a)}finally{this.loading_storeopen=!1}},SimilarItems(){this.similar_loading=!0,r.fetchDataPost("SimilarItems","rows=infinite").then(t=>{this.similar_data=t.details.data}).catch(t=>{this.similar_data=[]}).then(t=>{this.similar_loading=!1})},geStoreMenu(t){this.menu_loading=!0;const a=n();r.fetchDataPost("geStoreMenu","currency_code="+a.getUseCurrency()).then(e=>{this.data_category=e.details.data.category,this.data_items=e.details.data.items,this.items_not_available=e.details.data.items_not_available,this.category_not_available=e.details.data.category_not_available,this.dish=e.details.data.dish}).catch(e=>{this.items_not_available=[],this.category_not_available=[]}).then(e=>{this.menu_loading=!1,r.empty(t)||t()})},getCartCount(){this.cartcount_loading=!0;const t=n(),a={cart_uuid:r.getStorage("cart_uuid"),local_id:r.getStorage("local_id"),currency_code:t.getUseCurrency(),payload:["subtotal","items_count"]};r.fetchDataPost("getCart",a).then(e=>{this.cartcount_data={items_count:e.details.items_count,subtotal:e.details.data.subtotal}}).catch(e=>{this.cartcount_data={items_count:0,subtotal:{raw:0}}}).then(e=>{this.cartcount_loading=!1})},async clearCart(){try{const t=await o.post("clearCart","cart_uuid="+r.getStorage("cart_uuid"));if(t.data.code==1){const a=t.data.details;return console.log("data",a),a}else return!1}catch(t){return console.error("Error fetching data:",t),t}finally{}}}});export{u};
