import{_ as D,ad as y,U as W,X as f,l as b,m as r,n as m,p as a,f as t,Q,S as g,R as i,Y as d,ac as k,F as _,af as $,bh as R,bg as L,$ as q,a0 as v,P as c,Z as S,ai as P}from"./index.c5b868f5.js";import{Q as V}from"./QToolbarTitle.4da9f270.js";import{Q as I}from"./QToolbar.9b15bf0e.js";import{Q as E}from"./QHeader.b374650f.js";import{Q as h}from"./QItemLabel.4665782c.js";import{Q as x}from"./QCircularProgress.1d7da185.js";import{Q as O}from"./QTab.efd359a5.js";import{Q as j}from"./QTabs.54389c7c.js";import{Q as N}from"./QList.9b7158f1.js";import{Q as z}from"./QInnerLoading.ff23f6a9.js";import{Q as U}from"./QInfiniteScroll.e5ee4582.js";import{Q as F}from"./QPageScroller.9f5fda23.js";import{Q as Y}from"./QPage.528ab8a8.js";import{Q as H}from"./QPullToRefresh.85618661.js";import"./QResizeObserver.3ed5059f.js";import"./format.8ac60962.js";import"./rtl.276c3f1b.js";import"./use-page-sticky.ec3ca395.js";import"./TouchPan.5486290b.js";import"./touch.9135741d.js";import"./selection.65959ca5.js";const X={name:"WalletPage",components:{WalletBunos:y(()=>P(()=>import("./WalletBunos.e38d4c4f.js"),["assets/WalletBunos.e38d4c4f.js","assets/swiper.75391432.js","assets/swiper.dbf2012b.css","assets/index.c5b868f5.js","assets/index.7897e990.css"])),WalletTopupform:y(()=>P(()=>import("./WalletTopupform.3ff0678d.js"),["assets/WalletTopupform.3ff0678d.js","assets/QSpace.24950ca6.js","assets/index.c5b868f5.js","assets/index.7897e990.css","assets/QCircularProgress.1d7da185.js","assets/format.8ac60962.js","assets/QImg.79fcc1c6.js","assets/QItemLabel.4665782c.js","assets/QForm.997d74f6.js","assets/ClosePopup.32eeb9ff.js"])),PaymentComponents:y(()=>P(()=>import("./PaymentComponents.fed87934.js"),["assets/PaymentComponents.fed87934.js","assets/index.c5b868f5.js","assets/index.7897e990.css"])),WalletTopupreceipt:y(()=>P(()=>import("./WalletTopupreceipt.a7933e07.js"),["assets/WalletTopupreceipt.a7933e07.js","assets/QItemLabel.4665782c.js","assets/index.c5b868f5.js","assets/index.7897e990.css","assets/QList.9b7158f1.js"]))},setup(){return{SettingStore:W()}},data(){return{data:[],loading:!1,tab:"all",tabList:[{value:"all",label:this.$t("All")},{value:"order",label:this.$t("Orders")},{value:"refund",label:this.$t("Refunds")},{value:"topup",label:this.$t("Top-ups")},{value:"cashback",label:this.$t("Cashbacks")},{value:"adjustment",label:this.$t("Adjustment")}],page:0,is_refresh:void 0,balance:0,loading_balance:!0,receipt_data:[],payment_credentials:[],page_ready:!1}},mounted(){Object.keys(this.SettingStore.settings_data).length>0?this.SettingStore.settings_data.digitalwallet_enabled?(this.page_ready=!0,this.getBalance()):this.$router.push("/home"):this.$watch(()=>this.SettingStore.$state.settings_data,(e,o)=>{this.page_ready=!0,e.digitalwallet_enabled?this.getBalance():this.$router.push("/home")})},computed:{hasData(){return this.data.length>0},getData(){return this.data}},methods:{setPaymentcredentials(e){this.payment_credentials=e},async refresh(e){await this.getBalance(),this.resetPagination(),this.$refs.bunos.getDiscount(),e()},async getBalance(){this.loading_balance=!0,f.fetchDataByTokenPost("getWalletBalance").then(e=>{this.balance=e.details.total}).catch(e=>{}).then(e=>{this.loading_balance=!1})},getTransactions(e,o){this.loading=!0,this.page=e,f.fetchDataByTokenPost("getWalletTransaction","page="+e+"&transaction_type="+this.tab).then(p=>{p.code==1?(this.data.push(p.details.data),p.details.end_results&&this.$refs.nscroll&&this.$refs.nscroll.stop()):this.$refs.nscroll&&this.$refs.nscroll.stop()}).catch(p=>{this.$refs.nscroll&&this.$refs.nscroll.stop()}).then(p=>{this.loading=!1,o(),f.empty(this.is_refresh)||this.is_refresh()})},tabChange(){this.resetPagination()},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},afterPreparepayment(e){try{this.$refs.payment_components.doPayments(e)}catch(o){f.notify("dark",o,"error",this.$q)}},afterSuccessfulpayment(e){this.receipt_data=e,this.$refs.topup.dialog=!1,this.$refs.receipt.dialog=!0},afterReceiptclose(){this.getBalance(),this.resetPagination()},afterCancelPayment(e){f.empty(e)||f.notify("dark",e,"error",this.$q)},closePayment(){this.$refs.topup.dialog=!1}}},Z={class:"text-weight-bold text-body1"},G={key:1,class:"text-weight-bold text-yellow-9 text-h6"},J={class:"q-pl-md q-pr-md q-pt-sm"},K={class:"q-pl-md q-pr-md q-pb-xl"},M={key:0,class:"flex flex-center text-grey text-body2 card-form"},ee={key:1,class:"row justify-center absolute-bottom"},te={class:"q-pa-md flex flex-center"},ae={class:"flex items-center q-gutter-x-sm"},re={class:"text-body2 text-grey"};function oe(e,o,p,T,s,n){const w=b("WalletBunos"),A=b("WalletTopupform"),B=b("PaymentComponents"),C=b("WalletTopupreceipt");return r(),m(H,{onRefresh:n.refresh},{default:a(()=>[t(E,{reveal:"",class:$({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:a(()=>[t(I,null,{default:a(()=>[t(Q,{onClick:o[0]||(o[0]=l=>e.$router.back()),round:"",dense:"",icon:"arrow_back",unelevated:"",color:e.$q.dark.mode?"grey":"mygrey","text-color":e.$q.dark.mode?"grey-9":"dark"},null,8,["color","text-color"]),t(V,{class:"text-weight-bold"},{default:a(()=>[g(i(e.$t("Digital Wallet")),1)]),_:1}),s.page_ready?(r(),d(_,{key:0},[T.SettingStore.settings_data.digitalwallet_enabled_topup?(r(),m(Q,{key:0,round:"",dense:"",icon:"add",unelevated:"",color:e.$q.dark.mode?"grey":"primary","text-color":e.$q.dark.mode?"grey-9":"white",onClick:o[1]||(o[1]=l=>this.$refs.topup.dialog=!0)},null,8,["color","text-color"])):k("",!0)],64)):k("",!0)]),_:1})]),_:1},8,["class"]),t(Y,null,{default:a(()=>[t(R,{flat:""},{default:a(()=>[t(L,{class:"q-pt-none q-pb-none"},{default:a(()=>[t(q,null,{default:a(()=>[t(v,null,{default:a(()=>[t(h,{class:"text-weight-bold"},{default:a(()=>[c("div",Z,i(e.$t("Available Balance")),1)]),_:1}),t(h,{caption:""},{default:a(()=>[g(i(e.$t("Your wallet transaction history")),1)]),_:1})]),_:1}),t(v,{side:""},{default:a(()=>[t(h,null,{default:a(()=>[s.loading_balance?(r(),m(x,{key:0,indeterminate:"",rounded:"",size:"25px",color:"primary"})):(r(),d("div",G,i(s.balance),1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c("div",J,[t(w,{ref:"bunos"},null,512),c("div",{class:$(["border-dark-greyx q-pa-xs radius20 q-mb-md",{"border-none bg-grey600":e.$q.dark.mode,"border-dark-grey":!e.$q.dark.mode}])},[t(j,{modelValue:s.tab,"onUpdate:modelValue":[o[2]||(o[2]=l=>s.tab=l),n.tabChange],dense:"",class:"text-grey","indicator-color":"transparent","active-color":"primary",align:"justify","narrow-indicator":"","no-caps":""},{default:a(()=>[(r(!0),d(_,null,S(s.tabList,l=>(r(),m(O,{key:l,name:l.value,label:l.label,"no-caps":"","content-class":"text-weight-500 "},null,8,["name","label"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])],2)]),c("div",K,[t(U,{ref:"nscroll",onLoad:n.getTransactions,offset:250},{default:a(()=>[!n.hasData&&!s.loading?(r(),d("div",M,i(e.$t("No data available")),1)):k("",!0),t(N,{separator:""},{default:a(()=>[(r(!0),d(_,null,S(n.getData,l=>(r(),d(_,{key:l},[(r(!0),d(_,null,S(l,u=>(r(),m(q,{key:u.transaction_date},{default:a(()=>[t(v,null,{default:a(()=>[t(h,null,{default:a(()=>[g(i(u.transaction_description),1)]),_:2},1024),t(h,{caption:""},{default:a(()=>[g(i(u.transaction_date),1)]),_:2},1024)]),_:2},1024),t(v,{side:""},{default:a(()=>[t(h,{class:$(["text-weight-bold",{"text-green":u.transaction_type=="credit","text-red":u.transaction_type=="debit"}])},{default:a(()=>[g(i(u.transaction_amount),1)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:1})]),loading:a(()=>[s.page<=1?(r(),m(z,{key:0,showing:!0,color:"primary",size:"md"})):s.page>1?(r(),d("div",ee,[c("div",te,[c("div",ae,[c("div",null,[t(x,{indeterminate:"",rounded:"",size:"30px",color:"primary"})]),c("div",re,i(e.$t("loading")),1)])])])):k("",!0)]),_:1},8,["onLoad"])]),t(F,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:a(()=>[t(Q,{fab:"",icon:"keyboard_arrow_up",color:e.$q.dark.mode?"grey":"grey-2","text-color":e.$q.dark.mode?"grey-9":"grey",padding:"xs"},null,8,["color","text-color"])]),_:1}),t(A,{ref:"topup",onAfterPreparepayment:n.afterPreparepayment,onSetPaymentcredentials:n.setPaymentcredentials},null,8,["onAfterPreparepayment","onSetPaymentcredentials"]),t(B,{ref:"payment_components",payment_credentials:s.payment_credentials,onAfterAddpayment:e.afterAddpayment,onAfterSuccessfulpayment:n.afterSuccessfulpayment},null,8,["payment_credentials","onAfterAddpayment","onAfterSuccessfulpayment"]),t(C,{ref:"receipt",data:s.receipt_data,onAfterReceiptclose:n.afterReceiptclose},null,8,["data","onAfterReceiptclose"])]),_:1})]),_:1},8,["onRefresh"])}var qe=D(X,[["render",oe]]);export{qe as default};
