const headerAuthorization={headers:{Authorization:`token ${token}`}};const app_plans=Vue.createApp({data(){return{loading:false,data:null,history_data:null,loading_history:false,loading_cancel:false,payment_code:null,subscriber_id:null,subscription_type:null,features_list:null,subscription_features:null}},created(){this.getActiveSubscriptions()},mounted(){this.getSubscriptionHistory();if(typeof subscriber_id!=="undefined"&&subscriber_id!==null){this.subscriber_id=subscriber_id}},computed:{hasData(){return this.data?true:false},getData(){return this.data?this.data:null},hasHistory(){return this.history_data?true:false}},methods:{getActiveSubscriptions(){this.loading=true;axios({method:"GET",url:plan_api+"/getActivePlan?language="+language,headers:{Authorization:`token ${token}`}}).then(t=>{if(t.data.code==1){this.data=t.data.details.data;this.features_list=t.data.details.features_list;this.subscription_features=t.data.details.subscription_features}else{this.data=null}}).catch(t=>{this.data=null}).then(t=>{this.loading=false})},getSubscriptionHistory(){this.loading_history=true;axios({method:"GET",url:plan_api+"/getSubscriptionHistory?language="+language,headers:{Authorization:`token ${token}`}}).then(t=>{if(t.data.code==1){this.history_data=t.data.details.data}}).catch(t=>{}).then(t=>{this.loading_history=false})},statusColor(t){let e="";switch(t){case"active":e="success";break;case"expired":e="danger";break;case"cancelled":case"payment failed":e="danger";break;case"pending":e="info";break}return e},confirmCancelSubscriptions(t){this.payment_code=t;ElementPlus.ElMessageBox.confirm("By cancelling, you will lose access to all benefits associated with your current plan. Any remaining item and order limits will be reset.","Are you sure you want to cancel your subscription?",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.cancelSubscriptions()}).catch(()=>{})},cancelSubscriptions(){this.loading_cancel=true;axios({method:"GET",url:front_api+"/"+this.payment_code+"/apiv2/cancelSubscriptions?language="+language+"&subscription_id="+this.data.subscription_id,headers:{Authorization:`token ${token}`}}).then(t=>{if(t.data.code==1){this.SetCancelSubscriptions()}else{ElementPlus.ElNotification({title:"Something went wrong",message:t.data.msg,type:"warning",position:"bottom-right"})}}).catch(t=>{}).then(t=>{this.loading_cancel=false})},SetCancelSubscriptions(){this.loading=true;axios({method:"POST",url:plan_api+"/SetCancelSubscriptions?language="+language,headers:{Authorization:`token ${token}`},data:"&subscription_id="+this.data.subscription_id}).then(t=>{if(t.data.code==1){this.data=t.data.details.data;this.getActiveSubscriptions();this.getSubscriptionHistory()}else{ElementPlus.ElNotification({title:"Something went wrong",message:t.data.msg,type:"warning",position:"bottom-right"})}}).catch(t=>{}).then(t=>{this.loading=false})},Subscribe(){this.subscription_type="subscribe";this.$refs.ref_plans.modal=true},UpdateSubscriptions(){this.subscription_type="updatesubscriptions";this.$refs.ref_plans.modal=true},RenewSubscriptions(){this.subscription_type="rewewsubscriptions";this.$refs.ref_plans.modal=true},createPaymentplan(t){console.log("subscriber_id",this.subscriber_id);console.log("subscription_type",this.subscription_type);console.log("package_id",t);this.loading=true;let e="YII_CSRF_TOKEN="+$("meta[name=YII_CSRF_TOKEN]").attr("content")+"&subscriber_id="+this.subscriber_id+"&package_id="+t;e+="&subscription_type="+this.subscription_type;e+="&success_url="+success_url;e+="&failed_url="+failed_url;axios({method:"POST",url:plan_api+"/createPaymentPlan?language="+language,headers:{Authorization:`token ${token}`},data:e}).then(t=>{if(t.data.code==1){window.location.href=payment_url+"?payment_id="+t.data.details.payment_id}else{ElementPlus.ElNotification({title:"Something went wrong",message:t.data.msg,type:"warning",position:"bottom-right"})}}).catch(t=>{}).then(t=>{this.loading=false})}}});const componentsPlanSelections={template:"#xtemplate_planselection",props:["subscription_type","package_id"],data(){return{modal:false,loading:false,data:null,plan_details:[]}},methods:{getSubscriptionList(){this.loading=true;axios({method:"GET",url:plan_api+"/getSubscriptionList?language="+language+"&subscription_type="+this.subscription_type+"&package_id="+this.package_id,headers:{Authorization:`token ${token}`}}).then(t=>{if(t.data.code==1){this.data=t.data.details.data;this.plan_details=t.data.details.plan_details}else{ElementPlus.ElNotification({title:"Something went wrong",message:t.data.msg,type:"warning",position:"bottom-right"})}}).catch(t=>{}).then(t=>{this.loading=false})},setChoosePlan(t){this.$emit("createPaymentplan",t)}}};app_plans.component("components-plan-selection",componentsPlanSelections);app_plans.use(ElementPlus);const vm_plans=app_plans.mount("#vue-subscriptions");