import{Q as _}from"./QCircularProgress.bcda6a33.js";import{Q as k}from"./QToolbarTitle.38b5862b.js";import{Q as f}from"./QSpace.0d53e539.js";import{_ as S,A as d,p as c,q as h,t as r,f as a,b8 as b,au as v,Z as m,$ as u,a4 as g,a2 as y,F as Q,a3 as w,a6 as B,a7 as T,ar as q,aS as x}from"./index.c29f7992.js";import{Q as C}from"./QToolbar.19752286.js";import{Q as D}from"./QList.04c37cb8.js";import{Q as $}from"./QFooter.478b051a.js";import{A as n}from"./AppBluetooth.81007bf8.js";import"./format.de7e9769.js";import"./QResizeObserver.0e413222.js";const A={name:"BTprinterList",data(){return{dialog:!1,loading:!1,data:[],new_data:[],device_list:[],paired_data:[]}},setup(){return{}},watch:{paired_data(e,t){console.log("PAIRED DATA=>"),console.log(JSON.stringify(e)),Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})},data(e,t){Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.device_list.includes(s.address)||this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})}},methods:{whenShow(){this.device_list=[],this.data=[],this.new_data=[],this.initBT()},setPrinter(e){this.dialog=!1,this.stopScan(),d.showLoadingBox("",this.$q),n.GetServices(e.address).then(t=>{this.disconnectBT(e.address),this.$emit("afterSelectprinter",e,t.services,t.characteristics)}).catch(t=>{d.notify("dark",t,"error",this.$q)}).then(t=>{d.hideLoadingBox(this.$q)})},disconnectBT(e){n.Disconnect(e).then(t=>{}).catch(t=>{}).then(t=>{})},initBT(){n.Enabled().then(e=>{this.retrieveDevice(),setTimeout(()=>{this.Scan()},100)}).catch(e=>{d.notify("dark",e.message,"error",this.$q)}).then(e=>{})},stopScan(){n.StopScan().then(e=>{this.dialog=!1}).catch(e=>{this.dialog=!1}).then(e=>{})},Scan(){this.loading=!0,n.Scan().then(e=>{this.data=e}).catch(e=>{this.data=[],d.notify("dark",e.message,"error",this.$q)}).then(e=>{this.loading=!1})},retrieveDevice(){n.retrieveDevice().then(e=>{this.paired_data=e}).catch(e=>{this.paired_data=[]}).then(e=>{})}}};function V(e,t,p,s,o,l){return c(),h(x,{modelValue:o.dialog,"onUpdate:modelValue":t[1]||(t[1]=i=>o.dialog=i),position:"bottom",onShow:l.whenShow,onHide:l.stopScan,persistent:""},{default:r(()=>[a(b,{class:"rounded-borders-top"},{default:r(()=>[a(C,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:r(()=>[a(k,{class:"text-dark text-weight-bold",style:{overflow:"inherit"}},{default:r(()=>[o.loading?(c(),h(_,{key:0,indeterminate:"",size:"20px",thickness:.22,rounded:"",color:"primary","track-color":"grey-3",class:"q-mr-sm"})):v("",!0),m(" "+u(e.$t("Bluetooth Printer")),1)]),_:1}),a(f),a(g,{onClick:t[0]||(t[0]=i=>o.dialog=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),a(D,{separator:""},{default:r(()=>[(c(!0),y(Q,null,w(o.new_data,i=>(c(),h(B,{key:i,clickable:"",onClick:L=>l.setPrinter(i)},{default:r(()=>[a(T,null,{default:r(()=>[m(u(i.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),a(f,{class:"q-pa-xl"}),a($,{class:"bg-white border-grey-top q-pa-sm row"},{default:r(()=>[t[2]||(t[2]=q("div",{class:"col"},null,-1)),a(g,{flat:"",label:e.$t("Cancel"),color:"dark",onClick:l.stopScan,"no-caps":"",class:"col"},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow","onHide"])}var J=S(A,[["render",V]]);export{J as default};
