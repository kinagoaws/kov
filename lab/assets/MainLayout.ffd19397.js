import{_ as v,d as b,aA as c,u as D,A as a,as as u,b6 as l,b7 as S,n as d,p as $,q as k,t as r,f as i,at as y,a4 as A,a1 as h,aB as p}from"./index.c29f7992.js";import{Q as C}from"./QToolbarTitle.38b5862b.js";import{Q as q}from"./QToolbar.19752286.js";import{Q as w}from"./QHeader.8a0fa205.js";import{Q}from"./QFooter.478b051a.js";import{Q as T,a as I}from"./QLayout.474c7888.js";import{u as O}from"./UserStore.28c5b9df.js";import{u as V}from"./AccessStore.abc714c5.js";import"./QResizeObserver.0e413222.js";const B=b({name:"MainLayout",components:{TabsMenu:c(()=>p(()=>import("./TabsMenu.db08f7a5.js"),["assets/TabsMenu.db08f7a5.js","assets/QRouteTab.a0aa795c.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QTabs.8a6f34eb.js","assets/QResizeObserver.0e413222.js","assets/rtl.276c3f1b.js","assets/AccessStore.abc714c5.js"])),NotiButton:c(()=>p(()=>import("./NotiButton.0135fb2a.js"),["assets/NotiButton.0135fb2a.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QBadge.50ff0feb.js","assets/index.e205827f.js","assets/UserStore.28c5b9df.js"]))},setup(){const e=D(),t=O(),o=V();return{DataStore:e,UserStore:t,AccessStore:o}},data(){return{online:!1,tab:"home",loading:!1}},created(){this.DataStore.storeAvailable(this.$q.capacitor),this.AccessStore.getRefreshAccess(),this.$q.capacitor&&this.DeviceInit(),this.$q.dark.set(this.DataStore.dark_mode)},watch:{DataStore:{immediate:!0,deep:!0,handler(e,t){e.loading_available||(this.online=this.DataStore.store_available),e.loading||this.checkAppVersion()}}},methods:{searchPage(){this.$route.path=="/menu"?(this.DataStore.search_item="",this.$router.push("/search/food")):this.$router.push("/search")},setOnline(){let e=this.online?"Confirm Going Online":"Confirm Going Offline",t=this.online?this.$t("Are you sure you want to take your business online and start accepting orders again?"):this.$t("Are you sure you want to take your business offline temporarily? This will prevent new orders from coming in. Your current orders will still be processed.");this.$q.dialog({title:this.$t(e),message:t,cancel:!0,persistent:!0,ok:{color:"dark",flat:!0,"no-caps":!0,label:this.$t("Confirm")},cancel:{color:"primary",flat:!0,"no-caps":!0,label:this.$t("Cancel")}}).onOk(()=>{this.DataStore.setStoreAvailable(this.online)}).onCancel(()=>{this.online=!this.online}).onDismiss(()=>{})},DeviceInit(){const e=a.getSession("mt_device_token"),t=a.getSession("mt_device_registered"),o=a.getSession("mt_device_registered_auth");u.authenticated()?o!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.updateDevice(e,s.identifier,n.platform)})}):t!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.registerDevice(e,s.identifier,n.platform)})}),this.subsribeDevice()},registerDevice(e,t,o){a.registerDevice(e,t,o).then(s=>{a.setSession("mt_device_registered",1)})},updateDevice(e,t,o){a.updateDevice(e,t,o).then(s=>{a.setSession("mt_device_registered_auth",1)})},checkAppVersion(){this.$q.capacitor&&(this.$q.platform.is.android&&this.DataStore.app_version_android>0?this.DataStore.app_version_android>this.DataStore.app_version&&this.$router.replace("/update-app"):this.$q.platform.is.ios&&this.DataStore.app_version_ios>0&&this.DataStore.app_version_ios>this.DataStore.app_version&&this.$router.replace("/update-app"))},subsribeDevice(){let e=u.getUser();e&&!this.DataStore.push_off&&S.subscribeTo({topic:e.merchant_uuid}).then(t=>{this.DataStore.push_notifications=!0}).catch(t=>{this.DataStore.push_notifications=!1,a.notify("dark","Error subscribing topics"+JSON.stringify(t),"warning",this.$q)})}}});function P(e,t,o,s,n,U){const f=d("NotiButton"),m=d("TabsMenu"),_=d("router-view");return $(),k(T,{view:"lHh Lpr lFf"},{default:r(()=>[i(w,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(q,null,{default:r(()=>[i(y,{modelValue:e.online,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.online=g),e.setOnline],color:"primary",label:e.$t("Online")},null,8,["modelValue","label","onUpdate:modelValue"]),i(C),i(f),i(A,{round:"",color:"grey",icon:"search",flat:"",onClick:e.searchPage},null,8,["onClick"])]),_:1})]),_:1},8,["class"]),i(Q,{bordered:"",class:"bg-white text-dark modified-footer"},{default:r(()=>[i(m)]),_:1}),i(I,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(_)]),_:1},8,["class"])]),_:1})}var J=v(B,[["render",P]]);export{J as default};
