import{_ as R,aA as S,u as E,A as d,n as w,p as n,q as h,t,f as e,a4 as y,Z as i,$ as o,a2 as p,au as f,F as k,a0 as I,a1 as T,ar as B,a6 as _,a7 as c,a8 as O,a3 as P,aB as C,a5 as z}from"./index.c29f7992.js";import{Q as N}from"./QToolbarTitle.38b5862b.js";import{Q as U}from"./QToolbar.19752286.js";import{Q as F}from"./QHeader.8a0fa205.js";import{Q as j}from"./QInnerLoading.d034c390.js";import{Q as H}from"./QImg.a00dd4e9.js";import{Q as r}from"./QItemLabel.1db45aa2.js";import{Q as v}from"./QList.04c37cb8.js";import{Q as q}from"./QTab.0d7719d3.js";import{Q as G}from"./QTabs.8a6f34eb.js";import{Q as M,a as D}from"./QTabPanels.38ab23f8.js";import{Q as Z,a as J}from"./QStepper.8d8f9ae8.js";import{Q as K}from"./QInfiniteScroll.894949b1.js";import{Q as W}from"./QMenu.074d3579.js";import{Q as X}from"./QFooter.478b051a.js";import{Q as Y}from"./QPage.1b02519d.js";import{Q as $}from"./QPullToRefresh.9f003a0c.js";import{C as x}from"./ClosePopup.ab93d23e.js";import{u as ee}from"./AccessStore.abc714c5.js";import"./QResizeObserver.0e413222.js";import"./rtl.276c3f1b.js";import"./use-panel.777e53e3.js";import"./touch.9135741d.js";import"./selection.53b1fe34.js";import"./use-render-cache.3aae9b27.js";import"./QSlideTransition.36283950.js";import"./TouchPan.5fac99c8.js";import"./format.de7e9769.js";const te={name:"ReservationOverview",components:{TableSummary:S(()=>C(()=>import("./TableSummary.454f9038.js"),["assets/TableSummary.454f9038.js","assets/QSkeleton.81a2bab8.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/swiper.min.38e7e8ee.js","assets/swiper.min.b39a1361.css"])),TableBookingList:S(()=>C(()=>import("./TableBookingList.f71a2686.js"),["assets/TableBookingList.f71a2686.js","assets/QSpace.0d53e539.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QBadge.50ff0feb.js","assets/QItemLabel.1db45aa2.js","assets/QList.04c37cb8.js","assets/AccessStore.abc714c5.js"])),TableSkeleton:S(()=>C(()=>import("./TableSkeleton.3238dea0.js"),["assets/TableSkeleton.3238dea0.js","assets/QSkeleton.81a2bab8.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QItemLabel.1db45aa2.js","assets/QList.04c37cb8.js"]))},setup(){const a=E(),l=ee();return{DataStore:a,AccessStore:l}},data(){return{data:[],id:"",loading:!1,loading_update:!1,room_names:[],table_names:[],tab:"details",step:0,loading_summary:!0,data_summary:[],timeline:[],booking_loading:!1,booking_data:[],page:0,is_refresh:void 0,data_done:!1,status:[],customer_data:[]}},created(){this.id=this.$route.query.id,this.getBookingDetails(),this.reservationSummary()},updated(){this.id=this.$route.query.id,this.tab="details",this.getBookingDetails(),this.reservationSummary()},computed:{getData(){return this.data},hasData(){return Object.keys(this.data).length>0}},methods:{refresh(a){this.getBookingDetails(a),this.reservationSummary()},TabChange(a){this.booking_data=[],this.page=0},reservationList(a,l){this.booking_loading=!0,d.fetchDataByTokenPost("CustomerReservationList","id="+this.id+"&page="+a).then(g=>{g.code==1?(this.page=a,this.booking_data.push(g.details.data),this.status=g.details.status_list):g.code==3&&(this.data_done=!0,d.empty(this.$refs.nscroll)||this.$refs.nscroll.stop())}).catch(g=>{this.data_done=!0,d.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(g=>{l(),this.booking_loading=!1,d.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.booking_data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},getBookingDetails(a){d.empty(a)&&(this.loading=!0),d.fetchDataByTokenPost("getBookingDetails","id="+this.id).then(l=>{this.data=l.details.data,this.room_names=l.details.room_names,this.table_names=l.details.table_names,this.timeline=l.details.timeline,this.customer_data=l.details.customer_data}).catch(l=>{}).then(l=>{this.loading=!1,d.empty(a)||a()})},reservationSummary(){this.loading_summary=!0,d.fetchDataByTokenPost("BookingCustomerSummary","id="+this.id).then(a=>{this.data_summary=a.details.data}).catch(a=>{}).then(a=>{this.loading_summary=!1})},updateStatus(a){d.showLoadingBox("",this.$q),this.loading_update=!0,d.fetchDataByTokenPost("UpdateBookingStatus","id="+this.id+"&status="+a).then(l=>{this.BookingDetails(),d.notify(this.$q.dark.mode?"grey600":"light-green",l.msg,"check_circle",this.$q)}).catch(l=>{d.notify("dark",l,"error",this.$q)}).then(l=>{d.hideLoadingBox(this.$q),this.loading_update=!1})},BookingDetails(){this.$q.loading.show({spinnerSize:30}),d.fetchDataByTokenPost("getBookingDetails","id="+this.id).then(a=>{this.data=a.details.data,this.room_names=a.details.room_names,this.table_names=a.details.table_names,this.timeline=a.details.timeline,this.customer_data=a.details.customer_data}).catch(a=>{}).then(a=>{this.$q.loading.hide()})},confirmDelete(){this.$q.dialog({title:this.$t("Delete Confirmation"),message:this.$t("Are you sure you want to permanently delete the selected item?"),transitionShow:"fade",transitionHide:"fade",cancel:!0,ok:{unelevated:!0,color:"primary",rounded:!1,"text-color":"white",size:"md",label:this.$t("Okay"),"no-caps":!0},cancel:{unelevated:!0,color:"blue",rounded:!1,"text-color":"white",size:"md",label:this.$t("Cancel"),"no-caps":!0}}).onOk(()=>{this.deleteBooking()}).onCancel(()=>{}).onDismiss(()=>{})},deleteBooking(){this.$q.loading.show({spinnerSize:30,spinnerColor:"primary"}),d.fetchDataByTokenPost("deleteBooking","id="+this.id).then(a=>{d.notify("light-green",a.msg,"check_circle",this.$q),this.$router.replace({path:"/table/menu"})}).catch(a=>{}).then(a=>{this.$q.loading.hide()})}}},ae={key:1,class:"text-grey"},se={key:2,class:"border-grey radius28 { q-pa-xs"},oe={key:0,class:"row q-gutter-sm full-width"},le={class:"col"},ie={class:"col"};function re(a,l,g,b,s,u){const A=w("TableSummary"),V=w("TableBookingList"),L=w("TableSkeleton");return n(),h($,{onRefresh:u.refresh},{default:t(()=>[e(F,{class:T({"bg-mydark text-white":a.$q.dark.mode,"bg-white text-dark":!a.$q.dark.mode})},{default:t(()=>[e(U,null,{default:t(()=>[e(y,{onClick:l[0]||(l[0]=m=>a.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:a.$q.dark.mode?"white":"dark"},null,8,["color"]),e(N,{class:"text-weight-bold"},{default:t(()=>[i(o(a.$t("Overview")),1)]),_:1}),b.AccessStore.hasAccess("booking.reservation_delete")?(n(),p(k,{key:0},[u.hasData?(n(),h(y,{key:0,onClick:u.confirmDelete,flat:"",round:"",dense:"",icon:"las la-trash-alt",color:a.$q.dark.mode?"white":"dark"},null,8,["onClick","color"])):f("",!0)],64)):f("",!0)]),_:1}),e(I)]),_:1},8,["class"]),e(Y,{class:T([{"bg-mydark text-white":a.$q.dark.mode,"bg-white text-dark":!a.$q.dark.mode,"flex flex-center":!u.hasData&&!s.loading},"q-pa-md"])},{default:t(()=>[s.loading?(n(),h(j,{key:0,showing:!0,color:"primary",size:"md"})):f("",!0),!u.hasData&&!s.loading?(n(),p("div",ae,[B("p",null,o(a.$t("No data available")),1)])):(n(),p(k,{key:2},[u.hasData?(n(),h(v,{key:0},{default:t(()=>[e(_,null,{default:t(()=>[e(c,{avatar:""},{default:t(()=>[e(O,null,{default:t(()=>[e(H,{style:{height:"40px",width:"40px"},src:s.customer_data.avatar,"spinner-size":"sm","spinner-color":"primary"},null,8,["src"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(r,null,{default:t(()=>[i(o(s.customer_data.first_name)+" "+o(s.customer_data.last_name),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(a.$t("Phone"))+": "+o(s.customer_data.contact_phone),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(a.$t("Email"))+": "+o(s.customer_data.email_address),1)]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),u.hasData?(n(),h(A,{key:1,ref:"table_summary",loading:s.loading_summary,data:s.data_summary},null,8,["loading","data"])):f("",!0),u.hasData?(n(),p("div",se,[e(G,{modelValue:s.tab,"onUpdate:modelValue":[l[1]||(l[1]=m=>s.tab=m),u.TabChange],dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"","no-caps":""},{default:t(()=>[e(q,{name:"details",label:a.$t("Details")},null,8,["label"]),e(q,{name:"customer",label:a.$t("Customer")},null,8,["label"]),e(q,{name:"timeline",label:a.$t("Timeline")},null,8,["label"]),e(q,{name:"reservation",label:a.$t("Reservation")},null,8,["label"])]),_:1},8,["modelValue","onUpdate:modelValue"])])):f("",!0),u.hasData?(n(),h(M,{key:3,modelValue:s.tab,"onUpdate:modelValue":l[3]||(l[3]=m=>s.tab=m)},{default:t(()=>[e(D,{name:"details"},{default:t(()=>[e(v,null,{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Reservation ID")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.reservation_id),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Guest")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.guest_number),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Date/Time")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.reservation_date)+" "+o(s.data.reservation_time),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Table/Room")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[s.table_names[s.data.table_id]?(n(),p(k,{key:0},[i(o(s.table_names[s.data.table_id]),1)],64)):f("",!0),l[4]||(l[4]=i(" / ")),s.room_names[s.data.room_id]?(n(),p(k,{key:1},[i(o(s.room_names[s.data.room_id]),1)],64)):f("",!0)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Date booked")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.reservation_datetime),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{name:"customer"},{default:t(()=>[e(v,null,{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Name")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.full_name),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Email")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.email_address),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Phone")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.contact_phone),1)]),_:1})]),_:1})]),_:1}),e(_,{class:"q-pa-none"},{default:t(()=>[e(c,null,{default:t(()=>[e(r,{lines:"1"},{default:t(()=>[i(o(a.$t("Special Request")),1)]),_:1}),e(r,{caption:""},{default:t(()=>[i(o(s.data.special_request),1)]),_:1}),s.data.cancellation_reason?(n(),h(r,{key:0,caption:""},{default:t(()=>[i(o(a.$t("CANCELLATION NOTES"))+" = "+o(s.data.cancellation_reason),1)]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{name:"timeline",class:"no-shadow q-pl-none q-pr-none"},{default:t(()=>[e(Z,{modelValue:s.step,"onUpdate:modelValue":l[2]||(l[2]=m=>s.step=m),vertical:"",color:"dark","active-color":"blue","inactive-color":"grey-5",animated:"",class:"no-shadow q-pa-none","active-icon":"done"},{default:t(()=>[(n(!0),p(k,null,P(s.timeline,(m,Q)=>(n(),h(J,{key:m,name:Q,title:m.content,caption:m.timestamp,done:!1,icon:"fiber_manual_record"},null,8,["name","title","caption"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(D,{name:"reservation",class:"no-shadow q-pl-none q-pr-none"},{default:t(()=>[e(K,{ref:"nscroll",onLoad:u.reservationList,offset:250},{loading:t(()=>[s.page<=0?(n(),h(L,{key:0,rows:10})):(n(),h(L,{key:1,rows:1}))]),default:t(()=>[e(V,{data:s.booking_data,status:s.status},null,8,["data","status"])]),_:1},8,["onLoad"])]),_:1})]),_:1},8,["modelValue"])):f("",!0)],64)),!s.loading&&u.hasData?(n(),h(X,{key:3,class:T(["bg-whitex q-pl-md q-pr-md q-pt-sm q-pb-sm",{"bg-grey600 text-white":a.$q.dark.mode,"bg-white":!a.$q.dark.mode}])},{default:t(()=>[b.AccessStore.hasAccess("booking.update_status")?(n(),p("div",oe,[B("div",le,[e(y,{class:"full-width radius8",size:"lg",color:"primary","no-caps":"",unelevated:"",to:{path:"/tables/update_reservation",query:{id:s.id}}},{default:t(()=>[i(o(a.$t("Edit")),1)]),_:1},8,["to"])]),B("div",ie,[e(y,{class:"full-width radius8",size:"lg",color:"blue","no-caps":"",unelevated:"",label:b.DataStore.getBookingStatus[s.data.status]?b.DataStore.getBookingStatus[s.data.status]:s.data.status,outline:"",loading:s.loading_update},{default:t(()=>[e(W,null,{default:t(()=>[e(v,{style:{"min-width":"200px"},separator:""},{default:t(()=>[(n(!0),p(k,null,P(b.DataStore.getBookingStatus,(m,Q)=>z((n(),h(_,{key:m,clickable:"",onClick:ne=>u.updateStatus(Q)},{default:t(()=>[e(c,null,{default:t(()=>[i(o(m),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[x]])),128))]),_:1})]),_:1})]),_:1},8,["label","loading"])])])):f("",!0)]),_:1},8,["class"])):f("",!0)]),_:1},8,["class"])]),_:1},8,["onRefresh"])}var Oe=R(te,[["render",re]]);export{Oe as default};
