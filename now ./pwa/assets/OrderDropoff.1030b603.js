import{_ as B,ar as k,au as C,u as T,X as u,p as w,q as n,Z as f,ae as a,j as o,v as r,bq as p,a1 as s,a4 as _,t as m,aj as c,ak as g,F as y,a0 as q,$ as b,bu as D,bv as x,aP as O,a5 as E,al as U}from"./index.5da0f878.js";import{Q as v}from"./QSpace.334d24e5.js";import{Q as L,a as j}from"./QBar.7b44c673.js";import{Q as V}from"./QImg.bfa83115.js";import{C as F}from"./ClosePopup.1829ecf0.js";import{A as P}from"./AppCamera.af5c46dd.js";import"./position-engine.78f240dd.js";import"./selection.a405500a.js";const I={name:"OrderDropoff",props:["order_uuid","merchants","data","order_meta","payment_list"],components:{OrderDetails:k(()=>C(()=>import("./OrderDetails.7374e8f8.js"),["assets/OrderDetails.7374e8f8.js","assets/QSkeleton.846fbbc5.js","assets/index.5da0f878.js","assets/index.96a3fb36.css","assets/QItemLabel.6219c46e.js","assets/QList.d63bde81.js"])),OrderHelp:k(()=>C(()=>import("./OrderHelp.8ed69995.js"),["assets/OrderHelp.8ed69995.js","assets/index.5da0f878.js","assets/index.96a3fb36.css","assets/QBar.7b44c673.js","assets/position-engine.78f240dd.js","assets/selection.a405500a.js","assets/QSpace.334d24e5.js","assets/QItemLabel.6219c46e.js","assets/QList.d63bde81.js","assets/ClosePopup.1829ecf0.js"])),UploaderFile:k(()=>C(()=>import("./UploaderFile.e4c96ce9.js"),["assets/UploaderFile.e4c96ce9.js","assets/index.5da0f878.js","assets/index.96a3fb36.css","assets/QCircularProgress.c739f372.js","assets/format.de7e9769.js"]))},setup(){return{Activity:T()}},data(){return{loading:!1,confirm_dialog:!1,confirm_dialog_drop:!1,photo_data:[],upload_enabled:!1,has_photo:!1,upload_path:"",featured_filename:"",featured_url:"",otp_code:""}},mounted(){},computed:{hasAddedProof(){if(this.Activity.settings_data.add_proof_photo){if(this.has_photo)return!0}else return!0;return!1},hasData(){return Object.keys(this.data).length>0},paymentLabel(){return(this.payment_list[this.data.payment_code]?this.payment_list[this.data.payment_code]:0)==1?this.$t("Paid online"):this.$t("Collect Cash")},isCash(){return(this.payment_list[this.data.payment_code]?this.payment_list[this.data.payment_code]:0)!=1},hasPhoto(){return!u.empty(this.featured_url)},hasPhotoData(){return Object.keys(this.photo_data).length>0}},methods:{hideDialog(){this.confirm_dialog=!1},showHelp(){this.$refs.order_help.show()},changeOrderStatus(e){this.loading=!0,u.showLoadingBox("",this.$q),u.fetchDataByToken(e,{order_uuid:this.order_uuid,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:"",otp_code:this.otp_code}).then(t=>{this.confirm_dialog_drop=!1,this.$emit("afterChangestatus",t.details)}).catch(t=>{u.notify("red-5",t,"error_outline",this.$q)}).then(t=>{u.hideLoadingBox(this.$q),this.loading=!1})},takePhoto(){this.$q.capacitor?P.isCameraEnabled().then(e=>{P.isFileAccessEnabled().then(t=>{P.getPhoto(1).then(l=>{this.photo_data=l,this.has_photo=!0}).catch(l=>{this.photo_data=[]})}).catch(t=>{u.notify("dark",t,"error",this.$q)})}).catch(e=>{u.notify("dark",e,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterSubmit(e){this.loading=!0,u.showLoadingBox("",this.$q),u.fetchDataByToken("deliveryfailed",{order_uuid:this.order_uuid,reason:e}).then(t=>{this.$refs.order_help.hide(),this.$emit("afterChangestatus",[])}).catch(t=>{u.notify("red-5",t,"error_outline",this.$q)}).then(t=>{u.hideLoadingBox(this.$q),this.loading=!1})},afterUploadfile(e){this.featured_filename=e.filename,this.featured_url=e.url_image,this.upload_path=e.upload_path,this.has_photo=!0},clearPhoto(){this.upload_enabled=!1,this.has_photo=!1,this.featured_filename="",this.featured_url="",this.upload_path="",this.photo_data=[]},hadData(){return Object.keys(this.photo_data).length>0}}},H={class:"no-margin"},N={class:"row items-center"},R={class:"col text-weight-medium"},X={class:"col-5 text-right"},Z={class:"flex items-center justify-end"},G={class:"no-margin"},J={class:"text-weight-bold"},K={class:"text-weight-medium"},M={class:"no-margin"},W={class:"row items-center"},Y={class:"col"},$={key:0,class:"col text-right text-weight-bold"},ee={class:"text-center"},te={class:"font15 text-weight-bold"},ae={class:"col text-center"},oe={class:"text-weight-bold"},le={class:"font11"},se={class:"row items-center"},re={class:"col font16 text-weight-bold"},de={class:"text-h7"},ie={key:0,class:"row items-center"},ne={class:"col"},he={class:"font16 text-weight-bold"},ue={class:"font14 line-normal"},_e={class:"col text-right"},ce={key:2,class:"q-mt-md"},fe={class:"font16 text-weight-bold q-mb-xs"};function me(e,t,l,A,d,i){const z=w("OrderDetails"),Q=w("UploaderFile"),S=w("OrderHelp");return n(),f(y,null,[a("div",{class:b(["bg-whitex q-pb-md",{"bg-mydark ":e.$q.dark.mode,"bg-white ":!e.$q.dark.mode}])},[o(g,{class:"no-shadow"},{default:r(()=>[o(p,null,{default:r(()=>[a("p",H,s(e.$t("Customer Details")),1),a("div",N,[a("div",R,s(l.data.full_name),1),a("div",X,[a("div",Z,[o(_,{round:"",color:"deep-orange",icon:"las la-exclamation-triangle",size:"12px",unelevated:"",flat:"",class:"q-mr-xs",onClick:i.showHelp},null,8,["onClick"]),o(_,{round:"",color:"primary",icon:"las la-map",size:"sm",unelevated:"",flat:"",class:"q-mr-xs",to:"/home/maps"}),l.order_meta[l.data.order_id]?(n(),m(_,{key:0,href:"tel:"+l.order_meta[l.data.order_id].contact_number,round:"",color:"mygreen",icon:"las la-phone-volume",size:"sm",unelevated:"",flat:""},null,8,["href"])):c("",!0)])])])]),_:1})]),_:1}),o(g,{class:b(["no-shadow card-borderedx no-border-radius",{"":e.$q.dark.mode,"card-bordered":!e.$q.dark.mode}])},{default:r(()=>[o(p,null,{default:r(()=>[a("p",G,s(e.$t("Order Details")),1),a("div",J,"Order#"+s(l.data.order_id),1),a("div",K,[l.order_meta[l.data.order_id]?(n(),f(y,{key:0},[l.order_meta[l.data.order_id].address1?(n(),f(y,{key:0},[q(s(l.order_meta[l.data.order_id].address1),1)],64)):c("",!0)],64)):c("",!0),q(" "+s(l.data.address),1)]),t[7]||(t[7]=a("div",{class:"q-pa-sm"},null,-1)),o(z,{order_uuid:l.order_uuid},null,8,["order_uuid"])]),_:1})]),_:1},8,["class"]),o(g,{class:"no-shadow no-border-radius"},{default:r(()=>[o(p,null,{default:r(()=>[a("p",M,s(e.$t("Payment")),1),a("div",W,[a("div",Y,s(i.paymentLabel),1),i.isCash?(n(),f("div",$,s(l.data.total),1)):c("",!0)]),o(v,{class:"q-pa-lg"}),o(v,{class:"q-pa-md"}),o(_,{label:e.$t("Drop-off"),onClick:t[0]||(t[0]=h=>d.confirm_dialog=!d.confirm_dialog),color:"primary",unelevated:"",class:"fit text-weight-bold",size:"lg","no-caps":"",style:D(`background-color:${l.data.delivery_steps.status_data.bg_color} !important;color:${l.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","style"])]),_:1})]),_:1})],2),o(O,{modelValue:d.confirm_dialog,"onUpdate:modelValue":t[3]||(t[3]=h=>d.confirm_dialog=h),position:"bottom"},{default:r(()=>[o(g,null,{default:r(()=>[o(p,null,{default:r(()=>[a("div",ee,[a("div",te,s(e.$t("Do you confirm order#"))+s(l.data.order_id)+" "+s(e.$t("Drop-off"))+"? ",1)])]),_:1}),o(x,{class:"q-gutter-md"},{default:r(()=>[o(_,{color:"primary","no-caps":"",label:e.$t("Confirm Drop-off"),unelevated:"",class:"fit text-weight-bold",size:"lg",onClick:t[1]||(t[1]=h=>d.confirm_dialog_drop=!0),style:D(`background-color:${l.data.delivery_steps.status_data.bg_color} !important;color:${l.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","style"]),o(_,{color:"blue","no-caps":"",label:e.$t("Cancel"),unelevated:"",flat:"",class:"fit text-weight-bold",size:"lg",onClick:t[2]||(t[2]=h=>d.confirm_dialog=!d.confirm_dialog)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(O,{modelValue:d.confirm_dialog_drop,"onUpdate:modelValue":t[6]||(t[6]=h=>d.confirm_dialog_drop=h),maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down",onShow:i.hideDialog},{default:r(()=>[o(g,null,{default:r(()=>[o(L,{class:"transparent q-pa-sm",style:{height:"auto"}},{default:r(()=>[a("div",ae,[a("div",oe,s(e.$t("Confirm Drop-off")),1),a("div",le,"Order #"+s(l.data.order_id),1)]),E((n(),m(_,{dense:"",flat:"",icon:"close"},{default:r(()=>[o(j,{class:"bg-white text-primary"},{default:r(()=>[q(s(e.$t("Close")),1)]),_:1})]),_:1})),[[F]])]),_:1}),o(v,{class:b(["q-pa-xs",{"":e.$q.dark.mode,"bg-grey-1":!e.$q.dark.mode}])},null,8,["class"]),o(p,null,{default:r(()=>[i.isCash?(n(),f(y,{key:0},[a("div",se,[a("div",re,s(e.$t("Total Payment")),1),t[8]||(t[8]=a("div",{class:"col text-right"},null,-1))]),a("div",de,s(l.data.total),1),a("p",null,s(e.$t("Collect cash from customer")),1)],64)):c("",!0),a("div",{class:b(["q-pt-sm",{"border-top":i.isCash,"border-bottom":!i.isCash}])},[A.Activity.settings_data.add_proof_photo?(n(),f("div",ie,[a("div",ne,[a("div",he,s(e.$t("Proof of Drop-off")),1),a("p",ue,s(e.$t("Add a photo as proof of Drop-off")),1)]),a("div",_e,[a("div",null,[d.has_photo?(n(),m(_,{key:0,flat:"",label:e.$t("Delete"),color:"primary","no-caps":"",class:"q-pr-none font17",onClick:i.clearPhoto},null,8,["label","onClick"])):(n(),m(_,{key:1,label:e.$t("Add photo"),flat:"",color:"primary","no-caps":"",class:"q-pl-none q-pr-none",onClick:i.takePhoto},null,8,["label","onClick"]))]),i.hasPhoto?(n(),m(V,{key:0,src:d.featured_url,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"50px","max-width":"50px"},class:"radius8"},null,8,["src"])):i.hasPhotoData?(n(),m(V,{key:1,src:d.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"50px","max-width":"50px"},class:"radius8"},null,8,["src"])):c("",!0)])])):c("",!0)],2),d.upload_enabled?(n(),f(y,{key:1},[o(v,{class:"q-pa-xs"}),o(Q,{ref:"uploader_file",path:"upload/order_proof",onAfterUploadfile:i.afterUploadfile},null,8,["onAfterUploadfile"])],64)):c("",!0),A.Activity.settings_data.enabled_delivery_otp?(n(),f("div",ce,[a("div",fe,s(e.$t("Enter order OTP code")),1),o(U,{modelValue:d.otp_code,"onUpdate:modelValue":t[4]||(t[4]=h=>d.otp_code=h),type:"number",label:e.$t("OTP Code"),outlined:"",color:"grey-5",mask:"#######","lazy-rules":"",rules:[h=>h&&h.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"])])):c("",!0)]),_:1}),o(x,{class:"fixed-bottom"},{default:r(()=>[o(_,{label:e.$t("Confirm Drop-off"),loading:d.loading,disabled:!i.hasAddedProof,onClick:t[5]||(t[5]=h=>i.changeOrderStatus("orderdelivered")),color:"primary",unelevated:"",class:"fit text-weight-bold",size:"lg","no-caps":"",style:D(`background-color:${l.data.delivery_steps.status_data.bg_color} !important;color:${l.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","loading","disabled","style"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),o(S,{ref:"order_help",list_type:"orderhelplist",title:e.$t("Report an issue"),onAfterSubmit:i.afterSubmit},null,8,["title","onAfterSubmit"])],64)}var qe=B(I,[["render",me]]);export{qe as default};
