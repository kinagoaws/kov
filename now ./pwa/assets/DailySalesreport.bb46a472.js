import{_ as C,aA as g,u as x,A as r,n as y,p as l,a2 as u,f as e,t as i,F as k,a1 as v,a3 as D,q as P,au as T,ar as d,$ as s,a4 as b,aB as $,a6 as A,a7 as B,Z as c}from"./index.c29f7992.js";import{Q as p}from"./QItemLabel.1db45aa2.js";import{Q as E}from"./QList.04c37cb8.js";import{Q as F}from"./QInfiniteScroll.894949b1.js";import{Q as I}from"./QSpace.0d53e539.js";import{Q as O}from"./QPageSticky.335c1979.js";import{Q as V}from"./QPageScroller.43c9aad6.js";import{Q as R}from"./QPage.1b02519d.js";import{Q as N}from"./QPullToRefresh.9f003a0c.js";import{P as z}from"./PrintTemplate.83312567.js";import{A as m}from"./AppBluetooth.81007bf8.js";import"./use-page-sticky.3a081baa.js";import"./TouchPan.5fac99c8.js";import"./touch.9135741d.js";import"./selection.53b1fe34.js";import"./format.de7e9769.js";const j={name:"InvoiceList",components:{TableSkeleton:g(()=>$(()=>import("./TableSkeleton.3238dea0.js"),["assets/TableSkeleton.3238dea0.js","assets/QSkeleton.81a2bab8.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QItemLabel.1db45aa2.js","assets/QList.04c37cb8.js"])),TableSummary:g(()=>$(()=>import("./TableSummary.454f9038.js"),["assets/TableSummary.454f9038.js","assets/QSkeleton.81a2bab8.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/swiper.min.38e7e8ee.js","assets/swiper.min.b39a1361.css"])),FilterDates:g(()=>$(()=>import("./FilterDates.02a95d16.js"),["assets/FilterDates.02a95d16.js","assets/QToolbarTitle.38b5862b.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QSpace.0d53e539.js","assets/QToolbar.19752286.js","assets/QDate.053d7758.js","assets/use-render-cache.3aae9b27.js","assets/date.1357beaa.js","assets/format.de7e9769.js","assets/QPopupProxy.612ef87b.js","assets/QMenu.074d3579.js","assets/selection.53b1fe34.js","assets/QForm.32515fc9.js","assets/ClosePopup.ab93d23e.js"])),PrinterList:g(()=>$(()=>import("./PrinterList.9c13fcd2.js"),["assets/PrinterList.9c13fcd2.js","assets/index.c29f7992.js","assets/index.8924bfb8.css","assets/QToolbarTitle.38b5862b.js","assets/QSpace.0d53e539.js","assets/QToolbar.19752286.js","assets/QList.04c37cb8.js","assets/QFooter.478b051a.js","assets/QResizeObserver.0e413222.js","assets/ClosePopup.ab93d23e.js","assets/UserStore.28c5b9df.js"]))},setup(){return{DataStore:x()}},created(){this.Summary()},computed:{hasData(){return Object.keys(this.data).length>0}},data(){return{loading:!1,data:[],page:0,status:[],is_refresh:void 0,handle:void 0,date_start:"",date_end:"",printer_details:[],restaurant_name:"",loading_summary:!1}},methods:{refresh(t){this.resetPagination(),this.Summary(),this.is_refresh=t},afterFilter(t){this.date_start=t.date_start,this.date_end=t.date_end,this.resetPagination()},List(t,a){this.loading=!0,r.fetchDataByTokenPost("dailyReportSales","&page="+t+"&date_start="+this.date_start+"&date_end="+this.date_end).then(n=>{n.code==1?(this.page=t,this.data.push(n.details.data)):n.code==3&&(this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop())}).catch(n=>{this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(n=>{a(),this.loading=!1,r.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},Summary(){this.loading_summary=!0,r.fetchDataByTokenPost("getDailySummary").then(t=>{this.data_summary=t.details.data}).catch(t=>{}).then(t=>{this.loading_summary=!1})},showPrinter(){this.$q.capacitor?this.DataStore.osVersion>=12?m.CheckBTConnectPermissionOnly().then(t=>{this.EnabledBT()}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):m.CheckLocationOnly().then(t=>{this.$refs.printer.dialog=!0}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):this.$refs.printer.dialog=!0},afterSelectprinter(t){this.printer_details=t,t.printer_model=="feieyun"?this.FPprint(t):this.$q.capacitor?this.CheckBT():r.notify("dark",this.$t("Bluetooth Printers works only in actual device"),"error",this.$q)},FPprint(t){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Printing..."),this.$q),r.fetchDataByTokenPost("FPprintdailysales","printer_id="+t.printer_id+"&date_start="+this.date_start+"&date_end="+this.date_end).then(a=>{r.notify("green",a.msg,"check",this.$q)}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})},CheckBT(){m.Enabled().then(t=>{this.BondAndConnect()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{})},BondAndConnect(){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Connecting..."),this.$q),m.Connect(this.printer_details.printer_uuid,this.printer_details.printer_model).then(t=>{this.Print()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{r.hideLoadingBox(this.$q)})},Print(){this.$refs.printer.dialog=!1,this.$q.loading.show({spinnerSize:30,spinnerColor:"primary"}),r.fetchDataByTokenPost("GetDailysales","date_start="+this.date_start+"&date_end="+this.date_end).then(t=>{let a=z.DailySales(this.printer_details.paper_width,t.details.restaurant_name,t.details.range,t.details.data);console.log("TEMPLATE ==>"),console.log(a.tpl_all),console.log(a.tpl_data),Object.keys(a).length>0&&(this.printer_details.printer_model=="sunmi"?this.printData(a.tpl_all):Object.entries(a.tpl_data).forEach(([n,f])=>{r.empty(f)||(n>0?setTimeout(()=>{console.log(f),this.printData(f)},2e3):(console.log(f),this.printData(f)))}))}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{this.$q.loading.hide()})},printData(t){r.showLoadingBox(this.$t("Printing..."),this.$q),m.Print(this.printer_details.printer_uuid,t,this.printer_details.printer_model,this.printer_details.service_id,this.printer_details.characteristics).then(a=>{}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})}}},G={class:"flex flex-center text-center"},M={class:"radius8 bg-green-10 text-white q-pa-xs text-center q-pl-sm q-pr-sm"},Z={class:"font14 text-weight-bold"},H={key:0,class:"full-width text-center flex flex-center",style:{"min-height":"calc(50vh)"}},J={class:"text-grey q-ma-none"},K={class:"column q-gutter-y-sm"};function U(t,a,n,f,_,h){const L=y("TableSummary"),S=y("TableSkeleton"),w=y("FilterDates"),Q=y("PrinterList");return l(),u(k,null,[e(N,{onRefresh:h.refresh},{default:i(()=>[e(R,{class:v([{"bg-mydark text-white":t.$q.dark.mode,"bg-grey-1 text-dark":!t.$q.dark.mode},"q-pr-md q-pl-md q-pt-md"])},{default:i(()=>[e(L,{ref:"table_summary",loading:_.loading_summary,data:t.data_summary,set_slide:2.5},null,8,["loading","data"]),e(F,{ref:"nscroll",onLoad:h.List},{default:i(()=>[e(E,{separator:"",class:v(["bg-whitex",{"bg-grey600 text-white":t.$q.dark.mode,"bg-white":!t.$q.dark.mode}])},{default:i(()=>[(l(!0),u(k,null,D(_.data,q=>(l(),u(k,{key:q},[(l(!0),u(k,null,D(q,o=>(l(),P(A,{key:o,clickable:"",to:{path:"/orderview",query:{order_uuid:o.order_uuid}}},{default:i(()=>[e(B,{avatar:"",top:""},{default:i(()=>[d("div",G,[d("div",null,[d("div",M,[d("div",Z," #"+s(o.order_id),1)])])])]),_:2},1024),e(B,{top:""},{default:i(()=>[e(p,{caption:"",class:"font12"},{default:i(()=>[c(s(o.date_created),1)]),_:2},1024),e(p,null,{default:i(()=>[c(s(o.service_name)+" - "+s(o.payment_name),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total Sales"))+" : "+s(o.sub_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Delivery Fee"))+" : "+s(o.delivery_fee),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tax"))+" : "+s(o.tax_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tip"))+" : "+s(o.courier_tip),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total"))+" : "+s(o.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"]))),128))],64))),128))]),_:1},8,["class"])]),loading:i(()=>[_.page<=0?(l(),P(S,{key:0,rows:10})):_.data.length>1?(l(),P(S,{key:1,rows:1})):T("",!0)]),_:1},8,["onLoad"]),!h.hasData&&!_.loading?(l(),u("div",H,[d("p",J,s(t.$t("No available data")),1)])):T("",!0),e(I,{class:"q-pa-md"}),e(O,{position:"bottom-right",offset:[18,18]},{default:i(()=>[d("div",K,[d("div",null,[e(b,{icon:"o_date_range",round:"",size:"md",color:t.$q.dark.mode?"grey600":"green","text-color":t.$q.dark.mode?"grey300":"white",unelevated:"",onClick:a[0]||(a[0]=q=>this.$refs.filter_date.dialog=!0)},null,8,["color","text-color"])]),d("div",null,[e(b,{icon:"las la-print",round:"",size:"md",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",unelevated:"",onClick:h.showPrinter,disable:!h.hasData},null,8,["color","text-color","onClick","disable"])])])]),_:1}),e(V,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:i(()=>[e(b,{fab:"",icon:"keyboard_arrow_up",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",dense:"",padding:"3px"},null,8,["color","text-color"])]),_:1})]),_:1},8,["class"])]),_:1},8,["onRefresh"]),e(w,{ref:"filter_date",onAfterFilter:h.afterFilter},null,8,["onAfterFilter"]),e(Q,{ref:"printer",onAfterSelectprinter:h.afterSelectprinter},null,8,["onAfterSelectprinter"])],64)}var ft=C(j,[["render",U]]);export{ft as default};
