import{_ as P,ar as S,u as $,ag as E,X as h,p as q,q as t,Z as l,j as d,v as g,F as c,$ as D,V as Q,ae as a,a4 as u,a1 as i,aj as r,t as y,a0 as m,a3 as L,bq as w,ak as x,au as A,ah as C}from"./index.5da0f878.js";import{Q as v}from"./QSpace.334d24e5.js";import{Q as p}from"./QBadge.78870c85.js";import{Q as T}from"./QPage.ab42a258.js";import{Q as R}from"./QPullToRefresh.b2c7d1c7.js";import{u as O}from"./ScheduleStore.0e67fa88.js";import{A as V}from"./AppLocation.7583bb97.js";import"./TouchPan.b989d673.js";import"./selection.a405500a.js";import"./format.de7e9769.js";const Y={name:"ShiftStatus",components:{AddCarPhoto:S(()=>A(()=>import("./AddCarPhoto.db90b519.js"),["assets/AddCarPhoto.db90b519.js","assets/index.5da0f878.js","assets/index.96a3fb36.css","assets/QBar.7b44c673.js","assets/position-engine.78f240dd.js","assets/selection.a405500a.js","assets/QSpace.334d24e5.js","assets/QImg.bfa83115.js","assets/ClosePopup.1829ecf0.js","assets/AppCamera.af5c46dd.js"])),PhotoCarousel:S(()=>A(()=>import("./PhotoCarousel.72319b1f.js"),["assets/PhotoCarousel.72319b1f.js","assets/QBar.7b44c673.js","assets/index.5da0f878.js","assets/index.96a3fb36.css","assets/position-engine.78f240dd.js","assets/selection.a405500a.js","assets/TouchPan.b989d673.js","assets/use-render-cache.3aae9b27.js","assets/ClosePopup.1829ecf0.js"]))},setup(){const e=$(),o=O();return{Activity:e,Schedule:o}},data(){return{loading:!1,schedule_uuid:"",location_enabled:!1,docs_data:[],employment_type:"",balance:[],loading_online:!1}},computed:{hasBalance(){return Object.keys(this.balance).length>0}},created(){this.Activity.settings_data.on_demand_availability?this.Activity.getOnlineStatus(null):(this.Schedule.$q=this.$q,this.Activity.setTitle(this.$t("Status")),this.Schedule.hadData()?(this.Schedule.runRemainingTime(),this.Schedule.startTimer()):this.Schedule.gettShift());let e=[];(e=E.getUser())&&(this.employment_type=e.employment_type),this.$q.capacitor&&this.locationEnabled(),this.getRemainingCashBalance()},unmounted(){this.Schedule.stopTimer()},mounted(){},methods:{refreshShift(e){this.Activity.settings_data.on_demand_availability?this.Activity.getOnlineStatus(e):this.Schedule.refreshShift(e),this.getRemainingCashBalance()},startWorking(e){this.schedule_uuid=e;let o=h.empty(this.Activity.settings_data)?!1:this.Activity.settings_data.task_take_pic;console.log("=>"+o),o?this.setPhoto():this.startShift(e)},setPhoto(e){this.$refs.car_photo.dialog=!0},afterAttachphoto(e){this.startShift(e)},startShift(e){h.showLoadingBox("Starting",this.$q),h.startShift({schedule_uuid:e}).then(o=>{this.Schedule.gettShift()}).catch(o=>{h.notify("red-5",o,"error_outline",this.$q)}).then(o=>{h.hideLoadingBox(this.$q)})},endShift(e){h.showLoadingBox("",this.$q),h.endShift({schedule_uuid:e}).then(o=>{this.Schedule.gettShift()}).catch(o=>{h.notify("red-5",o,"error_outline",this.$q)}).then(o=>{h.hideLoadingBox(this.$q)})},locationEnabled(){console.log("locationEnabled"),V.islocationEnabled().then(e=>{this.location_enabled=!0}).catch(e=>{this.location_enabled=!1})},viewDocs(e){this.docs_data=e,this.$refs.photo_carousel.dialog=!0},endBreak(e){h.showLoadingBox("",this.$q),h.fetchDataByTokenPost("endBreak","id="+this.Schedule.data_break.id).then(o=>{this.Schedule.gettShift()}).catch(o=>{h.notify("dark",o,"error",this.$q)}).then(o=>{h.hideLoadingBox(this.$q)})},getRemainingCashBalance(){h.fetchDataByTokenPost("getRemainingCashBalance").then(e=>{this.balance=e.details}).catch(e=>{this.balance=[]}).then(e=>{})},changeOnlineStatus(e){let o=e==!0?1:0;this.loading_online=!0,h.fetchDataByTokenPost("changeOnlineStatus","is_online="+o).then(k=>{this.Activity.is_online=k.details.is_online,this.Activity.is_online&&this.$router.push("/selectzone")}).catch(k=>{h.notify("red-5",k,"error_outline",this.$q)}).then(k=>{this.loading_online=!1})}}},N={key:0,class:"flex flex-center full-width q-pa-xl",style:{"min-height":"calc(50vh)"}},W={key:0,class:"flex q-gutter-x-sm"},I={class:""},j={class:"q-gitter-x-sm"},F={class:"q-mt-md"},G={class:"q-mb-none"},U={class:"row items-center q-pl-md q-pr-md q-pt-sm"},X={class:"col"},Z={key:0,class:"col text-right"},H={class:"q-pa-md text-left"},J={class:"text-h7 q-mb-sm font16"},K={class:"row items-start q-gutter-sm"},M={class:"col-3"},ee={class:"bg-grey-2 flex flex-center rounded-borders"},te={class:"text-center"},ae={class:"text-orange text-weight-bold font17"},se={class:"text-dark text-weight-bold font19"},le={class:"text-dark text-weight-medium font15"},ie={class:"ellipsis block",style:{width:"80px"}},oe={class:"col"},ne={class:"font14 text-weight-bold"},de={class:"flex"},ce={class:"q-ml-sm font15 text-weight-medium"},he={class:"font14 text-weight-bold ellipsis-2-lines"},re={class:"font12 text-weight-light ellipsis-2-lines"},ue={key:1,class:"font13 text-weight-medium text-green-5"},_e={key:2,class:"flex items-center"},fe={class:"q-ml-sm font14 text-weight-medium"},ge={key:0,class:"text-center q-pt-md"},me={key:0,class:"text-red text-weight-medium"},ye={class:"text-weight-bold"},ke={class:"q-mb-none"},be={class:"font14 text-weight-bold"},ve={class:"text-blue"},pe={class:"text-grey font12"},Se={key:1,class:"text-center"},qe={class:"font16 text-weight-bold"},we={class:"font11"};function xe(e,o,k,n,_,f){const B=q("AddCarPhoto"),z=q("PhotoCarousel");return t(),l(c,null,[d(R,{onRefresh:f.refreshShift},{default:g(()=>[d(T,{class:D({"flex flex-center":!n.Schedule.hasData&&!n.Schedule.loading,"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:g(()=>[n.Schedule.loading?(t(),l("div",N,[d(Q,{color:"primary",size:"2em"})])):(t(),l(c,{key:1},[n.Activity.settings_data.on_demand_availability?(t(),l("div",W,[a("div",I,[a("div",j,[d(u,{label:n.Activity.is_online?e.$t("Go offline"):e.$t("Go online"),color:n.Activity.is_online?"red-10":"indigo-7",loading:_.loading_online,unelevated:"",size:"lg","no-caps":"",class:"radius28",onClick:o[0]||(o[0]=s=>f.changeOnlineStatus(!n.Activity.is_online)),style:{"min-width":"150px"}},null,8,["label","color","loading"]),d(u,{unelevated:"",color:"white","text-color":"dark",size:"lg","no-caps":"",class:"radius28",icon:"tune",to:"/selectzone"})]),a("div",F,[_.location_enabled===!1?(t(),l(c,{key:0},[d(v,{class:"q-pa-xs"}),a("p",G,i(e.$t("Your location is disabled"))+". ",1),d(u,{to:"/location/permission",label:e.$t("Enabled Location"),unelevated:"",color:"blue",class:"text-weight-bold fit font16","no-caps":"",size:"lg"},null,8,["label"])],64)):r("",!0)])])])):(t(),l(c,{key:1},[n.Schedule.hasData?(t(),l(c,{key:0},[a("div",U,[a("div",X,[n.Schedule.isWorking?(t(),y(p,{key:0,"text-color":"white",style:{background:"#49c3a1"},label:"Working",class:"q-pa-sm q-pl-md q-pr-md text-weight-bold font15"})):(t(),y(p,{key:1,"text-color":"white",style:{background:"#9689e7"},label:"Not Working",class:"q-pa-sm q-pl-md q-pr-md text-weight-bold font15"}))]),n.Schedule.hasBreak?(t(),l("div",Z,[d(u,{unelevated:"",flat:"","no-caps":"",color:"blue",dense:"",onClick:f.endBreak},{default:g(()=>o[1]||(o[1]=[m("End Break")])),_:1},8,["onClick"])])):r("",!0)]),a("div",H,[a("div",J,i(e.$t("Today Schedule")),1),(t(!0),l(c,null,L(n.Schedule.data,s=>(t(),y(x,{key:s,class:"no-shadow q-mb-md"},{default:g(()=>[d(w,{class:"q-pa-sm"},{default:g(()=>[a("div",K,[a("div",M,[a("div",ee,[a("div",te,[a("div",ae,i(s.date_start_split.month),1),a("div",se,i(s.date_start_split.day),1),a("div",le,[a("span",ie,i(s.date_start_split.date_string),1)])])])]),a("div",oe,[a("div",ne,i(s.time_start)+" - "+i(s.time_end),1),a("div",de,[d(p,{color:"myyellow1"},{default:g(()=>[d(C,{name:"las la-car-side",size:"1.3em"})]),_:1}),a("div",ce,[n.Schedule.vehicle_data[s.vehicle_id]?(t(),l(c,{key:0},[m(i(n.Schedule.vehicle_maker[n.Schedule.vehicle_data[s.vehicle_id].maker])+" - "+i(n.Schedule.vehicle_data[s.vehicle_id].plate_number),1)],64)):r("",!0)])]),a("div",he,i(s.zone_name),1),a("div",re,i(s.instructions),1),n.Schedule.vehicle_documents[s.vehicle_id]?(t(),y(u,{key:0,label:e.$t("View Car Documents"),unelevated:"","no-caps":"",flat:"",class:"q-pa-none",size:"lg",color:"amber-5",onClick:b=>f.viewDocs(n.Schedule.vehicle_documents[s.vehicle_id])},null,8,["label","onClick"])):r("",!0),s.starting_in?(t(),l("div",ue,i(e.$t("Starting in"))+" "+i(s.starting_in),1)):r("",!0),s.shift_status=="started"?(t(),l("div",_e,[d(C,{name:"las la-check-circle",size:"sm",class:"text-mygreen"}),a("div",fe,i(e.$t("Ongoing")),1)])):r("",!0)])]),s.shift_status=="ready"||s.shift_status=="late"?(t(),l(c,{key:0},[a("p",null,i(e.$t("Are you ready"))+"?",1),d(u,{label:e.$t("Start Working Now"),unelevated:"",color:"primary",class:"text-weight-bold fit font17","no-caps":"",onClick:b=>f.startWorking(s.schedule_uuid),size:"lg"},null,8,["label","onClick"])],64)):s.shift_status=="started"?(t(),l(c,{key:1},[n.Schedule.hasBreak?(t(),l("div",ge,[n.Schedule.break_status=="break_ended"?(t(),l("span",me,i(e.$t("Your break is already ended")),1)):(t(),l(c,{key:1},[m(i(e.$t("You are on break until"))+" ",1),a("span",ye,i(n.Schedule.data_break.break_until_hours),1)],64))])):(t(),l(c,{key:1},[n.Schedule.can_request_break?(t(),y(u,{key:0,label:e.$t("Request Break"),unelevated:"",color:"primary",class:"text-weight-bold fit font17 q-mt-md","no-caps":"",size:"lg",to:{name:"request_break",query:{schedule_uuid:s.schedule_uuid}}},null,8,["label","to"])):r("",!0)],64))],64)):s.shift_status=="shift_ended"?(t(),l(c,{key:2},[a("p",null,i(e.$t("Shift schedule already passed")),1),d(u,{label:e.$t("Search Shifts"),unelevated:"",color:"primary",class:"text-weight-bold fit font17","no-caps":"",to:"/shift/find",size:"lg"},null,8,["label"])],64)):s.shift_status=="ended"?(t(),l(c,{key:3},[a("p",null,i(e.$t("Your shift is already done please click end shift"))+"! ",1),d(u,{label:e.$t("End shift"),unelevated:"",color:"red",class:"text-weight-bold fit","no-caps":"",onClick:b=>f.endShift(s.schedule_uuid),size:"lg"},null,8,["label","onClick"])],64)):r("",!0),n.Activity.settings_data.enabled_end_shift?(t(),l(c,{key:4},[s.shift_status=="started"||s.shift_status=="shift_ended"?(t(),l(c,{key:0},[d(v,{class:"q-pa-xs"}),d(u,{label:e.$t("End shift"),unelevated:"",color:"red",class:"text-weight-bold fit","no-caps":"",onClick:b=>f.endShift(s.schedule_uuid),size:"lg"},null,8,["label","onClick"])],64)):r("",!0)],64)):r("",!0),_.location_enabled===!1?(t(),l(c,{key:5},[d(v,{class:"q-pa-xs"}),a("p",ke,i(e.$t("Your location is disabled"))+". ",1),d(u,{to:"/location/permission",label:e.$t("Enabled Location"),unelevated:"",color:"blue",class:"text-weight-bold fit font16","no-caps":"",size:"lg"},null,8,["label"])],64)):r("",!0)]),_:2},1024)]),_:2},1024))),128)),f.hasBalance?(t(),y(x,{key:0,class:"no-shadow"},{default:g(()=>[d(w,null,{default:g(()=>[a("div",be,[m(i(e.$t("Balance"))+" : ",1),a("span",ve,i(_.balance.balance),1)]),a("div",pe,i(e.$t("Your remaining balance that you can accept cash order")),1)]),_:1})]),_:1})):r("",!0)])],64)):(t(),l("div",Se,[a("div",qe,[_.employment_type=="contractor"?(t(),l(c,{key:0},[m(i(e.$t("You don't have any shifts starting soon"))+". ",1)],64)):(t(),l(c,{key:1},[m(" You have no work schedule for today ")],64))]),a("p",we,[_.employment_type=="contractor"?(t(),l(c,{key:0},[m(i(e.$t("Search for more available shifts")),1)],64)):(t(),l(c,{key:1},[m(i(e.$t("Pull down the page to refresh")),1)],64))]),_.employment_type=="contractor"?(t(),y(u,{key:0,label:e.$t("Search Shifts"),unelevated:"",color:"primary",class:"text-weight-bold fit font17","no-caps":"",to:"/shift/find",size:"lg"},null,8,["label"])):r("",!0)]))],64))],64))]),_:1},8,["class"])]),_:1},8,["onRefresh"]),d(B,{ref:"car_photo",schedule_uuid:_.schedule_uuid,onAfterAttachphoto:f.afterAttachphoto},null,8,["schedule_uuid","onAfterAttachphoto"]),d(z,{ref:"photo_carousel",title:"Car Documents",data:_.docs_data},null,8,["data"])],64)}var Te=P(Y,[["render",xe]]);export{Te as default};
