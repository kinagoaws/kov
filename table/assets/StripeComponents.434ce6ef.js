import{Q as p}from"./QSpace.aa134d93.js";import{_,V as r,n as l,p as m,q as s,f as a,ae as g,ad as w,af as d,X as h,a0 as c,al as P,Y as y,bc as q,aj as f,$ as C,b0 as x}from"./index.e99838a1.js";import{Q as S}from"./QCircularProgress.bceb8870.js";import{C as b}from"./ClosePopup.05834fd1.js";import{l as k}from"./index.4f152a18.js";import"./format.2cae61da.js";const Q={name:"StripeComponents",props:["title","payment_code","payment_credentials","payment_details"],data(){return{modal:!1,loading:!0,stripe:null,elements:null,payment_loading:!1}},setup(){return{}},mounted(){k("https://js.stripe.com/v3/").then(()=>{}).catch(()=>{})},methods:{HideFunc(){this.loading=!1},initiatePayment(){this.modal=!0},Payment(){this.loading=!0;let t=this.payment_details;t.payment_code=this.payment_code,t.key=this.payment_credentials.attr1,r.PaymentPost(this.payment_code,"createIntent",t).then(e=>{this.renderPayment(e.details.client_secret)}).catch(e=>{r.notify(this.$q,this.$t("Error"),e,"myerror","highlight_off","bottom")}).then(e=>{this.loading=!1})},renderPayment(t){this.stripe=Stripe(this.payment_credentials.attr2),this.elements=this.stripe.elements({clientSecret:t});const e={layout:"tabs"};this.elements.create("payment",e).mount("#payment-element")},async SubmitPayment(){let t=this.elements;this.payment_loading=!0,this.stripe.confirmPayment({elements:t,redirect:"if_required"}).then(e=>{console.log("result",e),this.payment_loading=!1,e.error?r.notify(this.$q,this.$t("Error"),e.error.message,"myerror","highlight_off","bottom"):(console.log("result.id",e.paymentIntent.id),this.modal=!1,this.$emit("paymentCompleted",{transaction_id:e.paymentIntent.id,payment_code:this.payment_code}))})}}},V={class:"text-h6 text-weight-bold"},v={ref:"payment_element",id:"payment-element"};function E(t,e,i,N,n,o){return l(),m(x,{modelValue:n.modal,"onUpdate:modelValue":e[0]||(e[0]=u=>n.modal=u),persistent:"","transition-show":"scale","transition-hide":"scale",position:this.$q.screen.gt.sm?"standard":"bottom","full-width":!this.$q.screen.gt.sm,onShow:o.Payment,onHide:o.HideFunc},{default:s(()=>[a(g,{style:{width:"500px","max-width":"80vw"},class:w({"bg-grey600 text-white":t.$q.dark.mode})},{default:s(()=>[a(d,{class:"row items-center q-pb-none"},{default:s(()=>[h("div",V,c(i.title),1),a(p),P(a(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[b]])]),_:1}),a(q,{spaced:""}),n.loading?(l(),m(d,{key:0,class:"q-pa-md flex flex-center"},{default:s(()=>[a(S,{indeterminate:"",size:"60px",thickness:.3,rounded:"",color:"primary","track-color":"grey-3",class:"q-ma-md"})]),_:1})):f("",!0),a(d,{class:"q-pa-md"},{default:s(()=>[h("div",v,null,512),a(p,{class:"q-pa-md"}),n.loading?f("",!0):(l(),m(y,{key:0,"no-caps":"",color:"primary","text-color":"white",size:t.$q.screen.gt.sm?"xl":"lg",dense:"",class:"radius10 fit",unelevated:"",loading:n.payment_loading,onClick:o.SubmitPayment},{default:s(()=>[C(c(t.$t("Pay Now"))+" "+c(i.payment_details.total_pretty),1)]),_:1},8,["size","loading","onClick"]))]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","position","full-width","onShow","onHide"])}var j=_(Q,[["render",E]]);export{j as default};
