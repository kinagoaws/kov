import{v as S,r as b,c,o as A,D as z,h as D,g as F,_ as q,Q as E,R as P,V as h,n as R,p as C}from"./index.e99838a1.js";import{b as H}from"./format.2cae61da.js";const $=XMLHttpRequest,_=$.prototype.open,L=["top","right","bottom","left"];let p=[],f=0;function Q({p:t,pos:r,active:n,horiz:s,reverse:i,dir:l}){let e=1,a=1;return s===!0?(i===!0&&(e=-1),r==="bottom"&&(a=-1),{transform:`translate3d(${e*(t-100)}%,${n?0:a*-200}%,0)`}):(i===!0&&(a=-1),r==="right"&&(e=-1),{transform:`translate3d(${n?0:l*e*-200}%,${a*(t-100)}%,0)`})}function w(t,r){return typeof r!="number"&&(t<25?r=Math.random()*3+3:t<65?r=Math.random()*3:t<85?r=Math.random()*2:t<99?r=.6:r=0),H(t+r,0,100)}function I(t){f++,p.push(t),!(f>1)&&($.prototype.open=function(r,n){const s=[],i=()=>{p.forEach(e=>{(e.hijackFilter.value===null||e.hijackFilter.value(n)===!0)&&(e.start(),s.push(e.stop))})},l=()=>{s.forEach(e=>{e()})};this.addEventListener("loadstart",i,{once:!0}),this.addEventListener("loadend",l,{once:!0}),_.apply(this,arguments)})}function V(t){p=p.filter(r=>r.start!==t),f=Math.max(0,f-1),f===0&&($.prototype.open=_)}var N=S({name:"QAjaxBar",props:{position:{type:String,default:"top",validator:t=>L.includes(t)},size:{type:String,default:"2px"},color:String,skipHijack:Boolean,reverse:Boolean,hijackFilter:Function},emits:["start","stop"],setup(t,{emit:r}){const{proxy:n}=F(),s=b(0),i=b(!1),l=b(!0);let e=0,a=null,d;const y=c(()=>`q-loading-bar q-loading-bar--${t.position}`+(t.color!==void 0?` bg-${t.color}`:"")+(l.value===!0?"":" no-transition")),g=c(()=>t.position==="top"||t.position==="bottom"),T=c(()=>g.value===!0?"height":"width"),B=c(()=>{const o=i.value,u=Q({p:s.value,pos:t.position,active:o,horiz:g.value,reverse:n.$q.lang.rtl===!0&&["top","bottom"].includes(t.position)?t.reverse===!1:t.reverse,dir:n.$q.lang.rtl===!0?-1:1});return u[T.value]=t.size,u.opacity=o?1:0,u}),M=c(()=>i.value===!0?{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":s.value}:{"aria-hidden":"true"});function v(o=300){const u=d;return d=Math.max(0,o)||0,e++,e>1?(u===0&&o>0?m():a!==null&&u>0&&o<=0&&(clearTimeout(a),a=null),e):(a!==null&&clearTimeout(a),r("start"),s.value=0,a=setTimeout(()=>{a=null,l.value=!0,o>0&&m()},i._value===!0?500:1),i._value!==!0&&(i.value=!0,l.value=!1),e)}function j(o){return e>0&&(s.value=w(s.value,o)),e}function x(){if(e=Math.max(0,e-1),e>0)return e;a!==null&&(clearTimeout(a),a=null),r("stop");const o=()=>{l.value=!0,s.value=100,a=setTimeout(()=>{a=null,i.value=!1},1e3)};return s.value===0?a=setTimeout(o,1):o(),e}function m(){s.value<100&&(a=setTimeout(()=>{a=null,j(),m()},d))}let k;return A(()=>{t.skipHijack!==!0&&(k=!0,I({start:v,stop:x,hijackFilter:c(()=>t.hijackFilter||null)}))}),z(()=>{a!==null&&clearTimeout(a),k===!0&&V(v)}),Object.assign(n,{start:v,stop:x,increment:j}),()=>D("div",{class:y.value,style:B.value,...M.value})}});const O={name:"AjaxBar",setup(){const t=E(),r=P();return{RestaurantStore:t,DataPersisted:r}},mounted(){this.$watch(()=>this.RestaurantStore.$state.cart_update,(t,r)=>{t?h.empty(this.$refs.bar)||this.$refs.bar.start():setTimeout(()=>{h.empty(this.$refs.bar)||this.$refs.bar.stop()},500)}),this.$watch(()=>this.DataPersisted.$state.page_loading,(t,r)=>{t?h.empty(this.$refs.bar)||this.$refs.bar.start():setTimeout(()=>{h.empty(this.$refs.bar)||this.$refs.bar.stop()},500)})}};function U(t,r,n,s,i,l){return R(),C(N,{ref:"bar",position:"top",color:"blue",size:"3px","skip-hijack":""},null,512)}var J=q(O,[["render",U]]);export{J as default};
